(()=>{"use strict";function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(t,n){var r=t.toLowerCase(),a=e(r.split(":"),2),o=a[0],i=a[1];o=Number(o);var s=Number(i.replace(/(pm)|(am)|(\+\d)/g,"").trim());if(n){var c=t.match(/(\+\d)/);c&&(o+=24*c[0].split("+")[1])}return r.includes("pm")&&o%12!=0?o+=12:r.includes("am")&&o%12==0&&(o-=12),{hours:o,minutes:s}}function r(e){var t=n(e,!0);return 60*t.hours+t.minutes}function a(e,t){var n=Math.abs(e),r=Math.floor(n/60)%24,a=""+n%60;a=a.padStart(2,"0");var o="";return r<12?(o+=0===r?"12":r,o+=":".concat(a," AM")):(o+=12===r?12:"".concat(r-12),o+=":".concat(a," PM")),t&&n/60>24&&(o+="+".concat(Math.floor(n/60/24))),o}function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f,p,y,h,v,b,g,L={},E=[],T=[],S={},w=[],I={},x=!1,O=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,D=1067;p=window,y=document,h="script",v="ga",p.GoogleAnalyticsObject=v,p.ga=p.ga||function(){(p.ga.q=p.ga.q||[]).push(arguments)},p.ga.l=1*new Date,b=y.createElement(h),g=y.getElementsByTagName(h)[0],b.async=1,b.src="https://www.google-analytics.com/analytics.js",g.parentNode.insertBefore(b,g),ga("create","UA-164337457-1","auto"),ga("set","checkProtocolTask",(function(){})),ga("set","transport","beacon"),ga("require","displayfeatures"),ga("send","pageview","/index.html"),document.querySelectorAll(".table-header").forEach((function(e){return e.style.width="1418px"}));var N=document.querySelector(".departures-section"),M=document.querySelector(".departures-content"),j=document.querySelector(".departures-list"),q=document.querySelector(".returns-section"),C=(document.querySelector(".returns-content"),document.querySelector(".returns-list")),P=document.querySelector(".departures-time-bar-container"),H=document.querySelector(".departures-time-bar-container-header"),k=document.querySelector(".returns-time-bar-container"),_=document.querySelector(".returns-time-bar-container-header"),B=document.getElementById("loading"),F=document.querySelector("form"),R=document.querySelector("main"),G=document.getElementById("search-form-logo"),z=document.getElementById("results-logo");function U(e,t,n,r,a){t.innerHTML="",e.forEach((function(e){var s=document.createElement("li");s.classList.add("flight-list-item"),s.style.width="1418px",s.tabIndex="0",s.addEventListener("click",V),s.addEventListener("keypress",(function(e){[13,32].includes(e.keyCode)&&V(e)}));var c=document.createElement("div");c.classList.add("flight-list-item__left-column");var l=e.operatingAirline.display,d=e.marketingAirlineText,m=e.id,f=e.itinIds,p=(a?f.map((function(e){return L[e]})).sort((function(e,t){return e.fareNumber-t.fareNumber}))[0]:L["".concat(w[0].dataset.id,"-").concat(m)]).fareNumber,y=document.createElement("div");y.classList.add("cost-container");var h=document.createElement("span");h.classList.add("fare");var v="";I.searchByPoints?(h.classList.add("points"),h.textContent="".concat(Math.floor(p/I.pointsValue).toLocaleString("en")),v="points"):(h.classList.add("dollar"),h.textContent="$".concat(p.toLocaleString("en"))),y.append(h),y.append(v),c.append(y);var b=document.createElement("div");b.classList.add("airlines");var g=[l];d&&g.push(d),g.forEach((function(e,t){var n=document.createElement("span");n.textContent=e,n.title=e,0===t?n.classList.add("primary-airline"):n.classList.add("secondary-airline"),b.append(n)})),c.append(b);var E=function(e,t,n){var r,a=e.layovers,s=e.fromTimeDetails,c=e.toTimeDetails,l=e.duration,d=document.createElement("div"),m=document.createElement("div");m.classList.add("time-bar-segment-container"),m.dataset.content=l,d.append(m),(r=d.classList).add.apply(r,["time-bar-row","tooltip"]);var f,p=function(e,t){return[e,t].map((function(e,t){var n=e.displayHours,r=e.minutes,a=e.timeOfDay,o=(e.excessDays,document.createElement("div"));o.classList.add("time-container"),0===t?o.classList.add("departure-time"):o.classList.add("arrival-time");var i=String(r);return i=i.padStart(2,"0"),o.textContent="".concat(n,":").concat(i," ").concat(a),o}))}(s,c),y=0,h=0,v=document.createDocumentFragment(),b=o(a.length?a:[e]);try{for(b.s();!(f=b.n()).done;){var g=f.value,L=g.fromTime,E=g.toTime,T=g.isLayoverStop,S=g.from,w=(g.to,g.operatingAirline),I=w.color,x=w.display,O=E.match(/(\+\d)/),A=L.match(/(\+\d)/);if(!T){if(A){var D=i(A[0].split("+"),2),N=(D[0],D[1]);h=y+=Number(N)}if(O){var M=i(O[0].split("+"),2),j=(M[0],M[1]);h+=Number(j)}}var q=J(L,E,I,x,y,h,t,n).timeBarSegment;T||O&&(y=h),q.classList.add("time-bar-segment"),T&&(q.classList.add("layover"),q.dataset.content=S,q.style.width=1*q.style.width.replace("px","")+1+"px"),v.append(q)}}catch(e){b.e(e)}finally{b.f()}var C=v.children[v.childElementCount-1],P=Number(C.style.left.replace("px",""))+Number(C.style.width.replace("px","")),H=v.children[0].style.left,k=Number(H.replace("px",""));return m.style.left=v.children[0].style.left,m.append(v),p[0].style.left=k-107+"px",p[1].style.left=P+10+"px",d.append.apply(d,u(p)),d}(e,n,r);s.append(c),s.append(E),s.dataset.id=e.id,S[e.id]=s,t.append(s)}))}function W(e){var t=e.from,n=e.to,r=e.fromDate,a=e.toDate,o=e.cabin,s=e.numPax,c=e.roundtrip,l=document.getElementById("header");if(!(l.children.length>1)){for(var u=document.createDocumentFragment(),d={Airports:"".concat(t).concat(c?"&harr;":"&rarr;").concat(n),Depart:r,Return:a,Cabin:{econ:"Economy",prem_econ:"Premium Economy",business:"Business",first:"First"}[o],Passengers:s},m=0,f=Object.entries(d);m<f.length;m++){var p=i(f[m],2),y=p[0],h=p[1];if(h){var v=document.createElement("h2");v.classList.add("content");var b=document.createElement("span");b.classList.add("label"),b.innerText=y,v.append(b),v.innerHTML+=h,u.append(v)}}l.append(u)}}window.addEventListener("popstate",(function(){chrome.runtime.sendMessage({event:"CLEAR_SELECTIONS"}),function(){B.style.display="none",w.forEach((function(e){e.style.border="",delete e.dataset.selected,e.tabIndex="0"})),Y.forEach((function(e){return e.style.display=null})),w[0].querySelector(".fare").style.display=null,document.querySelector(".sort-container").style.display=null,document.querySelector(".section-header").textContent="Departures",q.style.display="none",x=!1,C.innerHTML="";var e=k.children[0];e.innerHTML="",k.innerHTML="",k.append(e),w=[],window.scroll(0,0)}()})),document.querySelectorAll(".sort-container").forEach((function(e){e.addEventListener("change",(function(e){var t,n;switch(e.target.value){case"pain":n=function(e,t){return e.pain-t.pain};break;case"price":n=function(e,t){return L[e.itinIds[0]].fareNumber-L[t.itinIds[0]].fareNumber},x&&(n=function(e,t){return L["".concat(w[0].dataset.id,"-").concat(e.id)].fareNumber-L["".concat(w[0].dataset.id,"-").concat(t.id)].fareNumber});break;case"duration":n=function(e,t){return e.durationMinutes-t.durationMinutes};break;case"stops":n=function(e,t){return e.layovers.length-t.layovers.length};break;case"takeoff":n=function(e,t){return r(e.fromTime)-r(t.fromTime)};break;case"landing":n=function(e,t){return r(e.toTime)-r(t.toTime)};break;default:return}var a=j,o=E;x&&(a=C,o=T);var i=o.slice().sort(n).map((function(e){var t=e.id;return S[t]}));a.innerHTML="",(t=a).append.apply(t,u(i))}))})),chrome.runtime.onMessage.addListener((function(e){switch(e.event){case"RESET_SEARCH":0,L={},E=[],T=[],S={},w=[],I=e.formData,f=0,x=!1,O=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,W(e.formData),N.style.display="none",j.innerHTML="";var t=H;t.innerHTML="",P.innerHTML="",P.style.display=null,P.append(t),q.style.display="none",C.innerHTML="",(t=_).innerHTML="",k.innerHTML="",k.append(t);break;case"FLIGHT_RESULTS_FOR_CLIENT":var n=e.flights,r=n.departureList,a=n.itins,o=e.formData;if(I=o,L=c(c({},L),a),R.style.display=null,F.style.display="none",G.style.display="none",z.style.display=null,r.length){E=r,N.style.display=null;var i=K(r),s=i.increment,l=i.startHourOffset,u=i.intervals,d=i.dayWidths;U(r,j,s,l,!0),$(r[0].timezoneOffset,P,H,u,d)}W(I);break;case"RETURN_FLIGHTS_FOR_CLIENT":var m=e.flights,p=m.returnList,y=m.itins;L=c(c({},L),y),T=p,x=!0,q.style.display=null,w[0].querySelector(".fare").style.display="none",B.style.display="none";var h=K(p),v=h.increment,b=h.startHourOffset,g=h.intervals,D=h.dayWidths;U(p,C,v,b,!1),$(p[0].timezoneOffset,k,_,g,D),window.scroll(0,window.pageYOffset+q.getBoundingClientRect().top);break;case"FOCUS_WEBPAGE_CLIENT":B.style.display="none";var M=w.pop();M.tabIndex="0",delete M.dataset.selected}}));var Y=[];function V(e){if(!e.currentTarget.dataset.selected){var t=e.currentTarget;if(t.dataset.selected=!0,t.tabIndex="-1",w.push(t),1===w.length&&I.roundtrip)B.style.display=null,history.pushState({},null,window.location.pathname),chrome.runtime.sendMessage({event:"DEPARTURE_SELECTED",departureId:t.dataset.id}),(Y=Array.from(M.querySelectorAll("li:not([data-selected='true'])"))).forEach((function(e){return e.style.display="none"})),document.querySelector(".sort-container").style.display="none",document.querySelector(".section-header").textContent="Your selected departure";else if(2===w.length||!I.roundtrip){var n=w.map((function(e){return e.dataset.id}));chrome.runtime.sendMessage({event:"HIGHLIGHT_TAB",selectedDepartureId:n[0],selectedReturnId:n[1]})}}}function $(e,t,r,o,s){t.style.width="1067px";var c=function(e,t,r){var o=document.createDocumentFragment(),s=D/(e.length-1),c=I.fromDate,l=I.from,u=I.to;x&&(c=I.toDate,l=I.to,u=I.from);for(var d,m=i(c.split("-").map((function(e){return Number(e)})),3),f=m[0],p=m[1],y=m[2],h=new Date(f,p-1,y),v=h.getDate(),b=0,g=0;g<e.length;g++){var L=function(e){var t=n(e).hours,r="";return t<=5?r="early-morning":t<=12?r="morning":t<5?r="afternoon":t<24&&(r="evening"),r},E=60*e[g],T=a(Math.abs(E)),S=T.replace(":00",""),w=document.createElement("div");w.classList.add("interval-time");var O=document.createElement("div"),A=document.createElement("span");A.classList.add("interval-time-text"),t?(w.classList.add("tz-change"),A.classList.add("tz-change")):(w.classList.add("no-tz-change"),A.classList.add("no-tz-change")),0===g?(w.classList.add("first"),A.classList.add("first"),A.dataset.content="Time at ".concat(l)):g>0&&O.classList.add("interval-line");var N,M="";if("12 AM"===S?M="midnight":"12 PM"===S&&(M="midday"),M&&(w.classList.add(M),(N=O.classList).add.apply(N,["interval-line",M]),A.classList.add(M)),"12 AM"===S||0===g){var j=document.createElement("span");(d=new Date(h.getTime())).setDate(v+b),j.innerText=d.toLocaleString("en-us",{weekday:"long"}),j.classList.add("day-of-the-week"),w.append(j),b++}A.innerText=S.toLowerCase(),A.classList.add(L(T)),w.append(A),w.style.left=s*g+"px",O.style.left=s*g+"px";var q=document.createElement("div");if(q.append(w),o.append(q),o.append(O),t){var C,P=E-t,H=a(Math.abs(P)).replace(":00",""),k=document.createElement("span");(C=k.classList).add.apply(C,["interval-time-text","timezone"]),0===g&&(k.classList.add("first"),k.dataset.content="Time at ".concat(u)),k.classList.add(L(T)),k.innerText=H.toLowerCase(),w.append(k)}}return o}(o,e);r.innerHTML="",r.append(c)}function J(e,t,r,a,o,i,s,c){var l=document.createElement("div"),u=function(e,t,r,a,o,i){var s=D/((f-1)*o*60),c=60,l=24*c,u=s*l,d=r*l-i*c,m=a*l-i*c,p=n(e),y=d+p.minutes+p.hours*c,h=n(t),v=m+h.minutes+h.hours*c,b=y*s,g=v*s;g<b&&(g+=u);return{timeBarWidth:g-b,startPositionPx:b}}(e,t,o,i,s,c),d=u.timeBarWidth,m=u.startPositionPx;return l.title="".concat(a," ").concat(e,"-").concat(t),l.style.width="".concat(d,"px"),l.style.backgroundColor=r,l.style.left="".concat(m,"px"),{timeBarSegment:l}}function K(e){var t=e.slice().sort((function(e,t){return e.fromTimeDetails.hours-t.fromTimeDetails.hours}))[0],n=e.slice().sort((function(e,t){return t.toTimeDetails.hours-e.toTimeDetails.hours}))[0];t.fromTimeDetails.hours<O&&(O=Math.max(0,t.fromTimeDetails.hours-2)),n.toTimeDetails.hours>A&&(A=n.toTimeDetails.hours+2);var r,a=O;a=a<12?0:12,A-O>72?r=6:A-a<=12?r=1:A-a<=24?a%4==0?r=2:a%3==0&&(r=3):r=a%4==0?4:3;for(var s=[],c=a;c<=A+r;)s.push(c),c+=r;f=s.length;var l,u=D/(f-1),d=[],m=0,p=o(s.entries());try{for(p.s();!(l=p.n()).done;){var y=i(l.value,2),h=y[0],v=y[1];v%24==0&&0!==v&&(d.push(u*(h-m)),m=h)}}catch(e){p.e(e)}finally{p.f()}return m!==s.length-1&&d.push(u*(s.length-1-m)),{intervals:s,increment:r,startHourOffset:a,dayWidths:d}}})();