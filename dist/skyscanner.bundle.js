(()=>{"use strict";const e={airlineDetailsMap:{"American Airlines":{display:"American",color:"#C5423E",code:"AA"},American:{display:"American",color:"#C5423E",code:"AA"},Delta:{display:"Delta",color:"#EE722E",code:"DL"},Southwest:{display:"Southwest",color:"#F6C04D",code:"WN"},United:{display:"United",color:"#235EA6",code:"UA"},"Air Canada":{display:"Air Canada",color:"#E53222",code:"AC"},"Alaska Airlines":{display:"Alaska",color:"#51172C",code:"AS"},jetBlue:{display:"jetBlue",color:"#5F90C8",code:"B6"},"JetBlue Airways":{display:"jetBlue",color:"#5F90C8",code:"B6"},"Spirit Airlines":{display:"Spirit",color:"#BBB140",code:"NK"},WestJet:{display:"WestJet",color:"#4BA89C",code:"WS"},Aeromexico:{display:"Aeromexico",color:"#000000",code:"AM"},"Frontier Airlines":{display:"Frontier",color:"#378055",code:"F9"},Interjet:{display:"Interjet",color:"#A8A8A8",code:"4O"},"Hawaiian Airlines":{display:"Hawaiian",color:"#4D388A",code:"HA"},"Sun Country Airlines":{display:"Sun Country",color:"#D79A71",code:"SY"},"Porter Airlines":{display:"Porter",color:"#0F2B53",code:"PD"},"China Southern Airlines":{display:"China Southern",color:"#93ACCA",code:"CZ"},Lufthansa:{display:"Lufthansa",color:"#EFB95D",code:"LH"},SWISS:{display:"Swiss",color:"#D42D21",code:"LX"},"China Eastern Airlines":{display:"China Eastern",color:"#A9545F",code:"MU"},"British Airways":{display:"British",color:"#EA8E8C",code:"BA"},Iberia:{display:"Iberia",color:"#D05653",code:"IB"},"Air China":{display:"Air China",color:"#DF524B",code:"CA"},"Emirates Airlines":{display:"Emirates",color:"#CF534F",code:"EK"},"KLM-Royal Dutch Airlines":{display:"KLM",color:"#44A0DC",code:"KL"},"Air France":{display:"Air France",color:"#DB3832",code:"AF"},"Turkish Airlines":{display:"Turkish",color:"#DB3832",code:"TK"},"Cathay Pacific":{display:"Cathay",color:"#2A645A",code:"CX"},"Cathay Dragon":{display:"Cathay",color:"#2A645A",code:"CX"},"EVA Airways":{display:"EVA",color:"#6F9F64",code:"BR"},"China Airlines":{display:"China Airlines",color:"#DAABB1",code:"CI"},"ANA Airlines":{display:"ANA",color:"#254897",code:"NH"},"Japan Airlines":{display:"Japan Airlines",color:"#E56E69",code:"JL"},"Air India":{display:"Air India",color:"#D47346",code:"AI"},"Qantas Airways":{display:"Qantas",color:"#E34538",code:"QF"},"Singapore Airlines":{display:"Sinagpore",color:"#EFA952",code:"SQ"},"ANA (All Nippon Airways)":{display:"ANA",color:"#0f4a8d"}},getAirlineName:function(e){if(!e||"string"!=typeof e)return;let t=e.trim();const n=this.airlineDetailsMap[t];return n&&(t=n.display),t},getAirlineDetails:function(e){let t=e.trim();return this.airlineDetailsMap[t]||{display:t,color:"#DFCCFB"}}},t=function(e){return e.toLowerCase().replace(" ","").trim()};let n;Sentry.init({dsn:"https://d7f3363dd3774a64ad700b4523bcb789@o407795.ingest.sentry.io/5277451"});let r=!1;const o="[class*='FlightsTicket_container'] [role='button']";let i=0;function l(){r=!1,chrome.runtime.sendMessage({event:"FOCUS_WEBPAGE"})}async function s(){if(r)return;const e=document.querySelector("[class^='FlightsDayView_results__']");if(!e)return m(),void await c();if(r)return;const t=Array.from(e.querySelectorAll("button")).find((e=>"Show more results"===e.textContent));t&&(t.click(),await c()),r||window.scroll(0,window.pageYOffset+500)}function c(){return new Promise((e=>{setTimeout(e,3e3)}))}function a(){return window.innerHeight+window.pageYOffset>=document.body.offsetHeight-2}function d(e=""){let t=Array.from(document.querySelectorAll(o+e));for(let e=0;e<t.length;e++){const n=t[e],r=Array.from(n.querySelectorAll("[class^='LegDetails_container']"));g(n,r),n.dataset.visited="true"}t.length||console.log("did not set itin ids")}chrome.runtime.onMessage.addListener((async function(e){switch(console.info("Received message ",e.event),e.event){case"BEGIN_PARSING":if(n=e.formData,document.body.textContent.includes("Page not found"))return void chrome.runtime.sendMessage({event:"NO_FLIGHTS_FOUND",provider:"skyscanner"});!function(){let e;new MutationObserver((function(t,n){clearTimeout(e),e=setTimeout((()=>{!async function(){if(r)return;let e,t=0;window.addEventListener("scroll",(function t(){if(r)return window.cancelAnimationFrame(e),void window.removeEventListener("scroll",t);let n=Array.from(document.querySelectorAll(o+':not([data-visited="true"])'));if(n.length){i+=n.length;const e=function(e=[]){let t=e.map((e=>{if(e.dataset.visited=!0,e.textContent.includes("Sponsored"))return null;let t;try{t=e.querySelector(A).textContent.trim()}catch(e){return null}const n=/\d stop/.test(e.textContent),r=Array.from(e.querySelectorAll("[class^='LegDetails_container']")),o=g(e,r);if(w[o]&&w[o]===t)return null;if(w[o]=t,n)return h.push(o),null;const[i,l]=C(r);return i?{departureFlight:i,returnFlight:l,fare:t.replace("$",""),currency:"$"}:null}));return t=t.filter((e=>e)),t}(n);e.length&&chrome.runtime.sendMessage({event:"FLIGHT_RESULTS_RECEIVED",flights:e,provider:"skyscanner"})}if(a()){if(window.cancelAnimationFrame(e),window.removeEventListener("scroll",t),!i&&!h.length)return void chrome.runtime.sendMessage({event:"NO_FLIGHTS_FOUND",provider:"skyscanner"});if(r)return;h.length&&(window.addEventListener("scroll",(function e(){0===window.pageYOffset&&(f(),window.removeEventListener("scroll",e))})),window.scroll(0,0))}})),e=window.requestAnimationFrame((async function n(r){t&&!(r-t>=1e3)||(await s(),t=r),e=window.requestAnimationFrame(n)}))}(),n.disconnect()}),5e3)})).observe(document.body,{childList:!0,subtree:!0})}();break;case"HIGHLIGHT_FLIGHT":const{selectedDepartureId:t,selectedReturnId:c}=e;r=!0,m(),function(){let e=document.getElementById("close");e&&e.click(),e=document.querySelector("[title='Close']"),e&&e.click()}(),window.cancelAnimationFrame(0),window.scroll(0,0);let u=10;setTimeout((()=>{const e=setInterval((async()=>{try{m(),d(),function(e,t){const n=document.querySelector(`${o}[data-selected='true']`);n&&(n.dataset.selected="false",n.style.border="");let r=e;t&&(r+=`-${t}`);const i=document.querySelector(`[data-id="${r}"]`);i.style.border="10px solid tomato",i.dataset.selected="true";const l=window.pageYOffset+i.getBoundingClientRect().top-window.innerHeight/2;window.scroll(0,l)}(t,c),clearInterval(e),function(){if(document.querySelector("#back-to-search"))return;const e=document.createElement("button");e.id="back-to-search",e.innerText="Return to FlightPenguin",e.title="Click to return to FlightPenguin and keep browsing.",e.addEventListener("click",l),document.body.append(e)}()}catch(t){if(u<1)return Sentry.captureException(t,{tags:{component:"highlightSkyscannerItin"},extra:n}),void clearInterval(e);await s(),u--}}),500)}),500)}}));const u={fromTime:"[class^='LegInfo_routePartialDepart'] *:first-child",toTime:"[class^='LegInfo_routePartialArrive'] *:first-child",duration:"[class^='LegInfo_stopsContainer'] *:first-child",layovers:"[class^='LegInfo_stopsLabelContainer'] *:first-child",marketingAirline:"[class^='LogoImage_container']",operatingAirline:"[class*='Operators_operator']",from:"[class*='LegInfo_routePartialDepart'] *:nth-child(2)",to:"[class*='LegInfo_routePartialArrive'] *:nth-child(2)"},y={from:"[class*='Routes_routes'] *:first-child",to:"[class*='Routes_routes'] *:nth-child(2)"},A="[class^='Price_mainPriceContainer']";function m(){const e=document.querySelector("[class*='DetailsPanelHeader_navigationBar'] button[label='back']");e&&e.click()}async function f(){if(!h.length||r)return void m();window.scroll(0,0);const e=h.shift();window.addEventListener("scroll",(async function t(){if(r)return void window.removeEventListener("scroll",t);const n=await p(e);n?(function(e){e.click();let t=setInterval((async()=>{const e=document.querySelector("[class*='FlightsBookingPanel_content']");if(!e)return;const n=function(e){const t=Array.from(e.querySelectorAll("[class^='Itinerary_leg']")),[n,r]=C(t);let o,i=e.querySelector("[class^='TotalPrice_totalPriceContainer']");i||(i=e.querySelector("[class*='CardPrice_totalPrice']"));try{o=i.textContent.trim().split("$")[1]}catch(e){return}return{departureFlight:n,returnFlight:r,fare:o,currency:"$"}}(e);n&&(chrome.runtime.sendMessage({event:"FLIGHT_RESULTS_RECEIVED",flights:[n],provider:"skyscanner"}),clearInterval(t),m(),await c(),d(),f())}),2e3)}(n),window.removeEventListener("scroll",t)):a()&&(f(),window.removeEventListener("scroll",t))})),p(e)}async function p(e){return await s(),d(':not([data-visited="true"])'),document.querySelector(`[data-id='${e}']`)}function g(n,r){let o=[];for(let n of r){const[r,i]=n.querySelectorAll("[class*='LegInfo_routePartialTime']"),l=n.querySelector(u.marketingAirline),s=n.getElementsByTagName("img")[0];let c="";c=s?s.alt:l.textContent,c=e.getAirlineName(c),o.push(t(r.textContent),t(i.textContent),c.trim())}const i=o.join("-");return n.dataset.id=i,i}const h=[],w={};function C(e){const t=[];for(const n of e){const e=S(n);t.push(e)}return t}function S(e){const n={};return Object.entries(u).forEach((([r,o])=>{const i=e.querySelector(o);if("operatingAirline"===r)n.operatingAirline=i?i.textContent.replace("Operated by",""):null;else if("marketingAirline"===r){const e=i.querySelector("img");n.marketingAirline=e?e.alt:i.textContent.trim()}else if("layovers"===r){let r=[];i.textContent.toLowerCase().includes("non")||(i.click(),r=function(e){const n=e.querySelector("[class^='LegSegmentSummary_container']"),r=Array.from(n.querySelectorAll("[class^='AirlineLogoTitle_container']")),o=Array.from(n.querySelectorAll("[class^='LegSegmentDetails_container']")),i=[];for(let e=0;e<o.length;e++){let[n,l,s]=o[e].querySelector("[class^='Times_segmentTimes']").children;n=t(n.textContent),s=t(s.textContent);const c={};for(let[t,n]of Object.entries(y)){const r=o[e].querySelector(n);c[t]=r.textContent.split(/\s/)[0]}const a=r[e].querySelector("[class^='LogoImage_container']"),d=r[e].querySelector("[class*='OperatedBy']");s.match(/(\+\d)/)||(e>0&&i[i.length-1].toTime.includes("pm")&&s.includes("am")||n.toLowerCase().includes("pm")&&s.toLowerCase().includes("am"))&&(s+="+1"),i.push({fromTime:n,duration:l.textContent,toTime:s,operatingAirline:d.textContent.toLowerCase().includes("operated")?d.textContent:a.textContent,...c})}return i}(e)),n.layovers=r}else["fromTime","toTime"].includes(r)?n[r]=t(i.textContent):n[r]=i.textContent.trim()})),n}})();