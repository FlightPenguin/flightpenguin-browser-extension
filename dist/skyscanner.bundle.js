(()=>{"use strict";var e=function(e){return e.toLowerCase().replace(" ","").trim()};const t={airlineDetailsMap:{"American Airlines":{display:"American",color:"#C5423E",code:"AA"},American:{display:"American",color:"#C5423E",code:"AA"},Delta:{display:"Delta",color:"#EE722E",code:"DL"},Southwest:{display:"Southwest",color:"#F6C04D",code:"WN"},United:{display:"United",color:"#235EA6",code:"UA"},"Air Canada":{display:"Air Canada",color:"#E53222",code:"AC"},"Alaska Airlines":{display:"Alaska",color:"#51172C",code:"AS"},jetBlue:{display:"jetBlue",color:"#5F90C8",code:"B6"},"JetBlue Airways":{display:"jetBlue",color:"#5F90C8",code:"B6"},"Spirit Airlines":{display:"Spirit",color:"#BBB140",code:"NK"},WestJet:{display:"WestJet",color:"#4BA89C",code:"WS"},Aeromexico:{display:"Aeromexico",color:"#000000",code:"AM"},"Frontier Airlines":{display:"Frontier",color:"#378055",code:"F9"},Interjet:{display:"Interjet",color:"#A8A8A8",code:"4O"},"Hawaiian Airlines":{display:"Hawaiian",color:"#4D388A",code:"HA"},"Sun Country Airlines":{display:"Sun Country",color:"#D79A71",code:"SY"},"Porter Airlines":{display:"Porter",color:"#0F2B53",code:"PD"},"China Southern Airlines":{display:"China Southern",color:"#93ACCA",code:"CZ"},Lufthansa:{display:"Lufthansa",color:"#EFB95D",code:"LH"},SWISS:{display:"Swiss",color:"#D42D21",code:"LX"},"China Eastern Airlines":{display:"China Eastern",color:"#A9545F",code:"MU"},"British Airways":{display:"British",color:"#EA8E8C",code:"BA"},Iberia:{display:"Iberia",color:"#D05653",code:"IB"},"Air China":{display:"Air China",color:"#DF524B",code:"CA"},"Emirates Airlines":{display:"Emirates",color:"#CF534F",code:"EK"},"KLM-Royal Dutch Airlines":{display:"KLM",color:"#44A0DC",code:"KL"},"Air France":{display:"Air France",color:"#DB3832",code:"AF"},"Turkish Airlines":{display:"Turkish",color:"#DB3832",code:"TK"},"Cathay Pacific":{display:"Cathay",color:"#2A645A",code:"CX"},"Cathay Dragon":{display:"Cathay",color:"#2A645A",code:"CX"},"EVA Airways":{display:"EVA",color:"#6F9F64",code:"BR"},"China Airlines":{display:"China Airlines",color:"#DAABB1",code:"CI"},"ANA Airlines":{display:"ANA",color:"#254897",code:"NH"},"Japan Airlines":{display:"Japan Airlines",color:"#E56E69",code:"JL"},"Air India":{display:"Air India",color:"#D47346",code:"AI"},"Qantas Airways":{display:"Qantas",color:"#E34538",code:"QF"},"Singapore Airlines":{display:"Sinagpore",color:"#EFA952",code:"SQ"},"ANA (All Nippon Airways)":{display:"ANA",color:"#0f4a8d"}},getAirlineName:function(e){if(e&&"string"==typeof e){var t=e.trim(),r=this.airlineDetailsMap[t];return r&&(t=r.display),t}},getAirlineDetails:function(e){var t=e.trim();return this.airlineDetailsMap[t]||{display:t,color:"#DFCCFB"}}};function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,l=e[Symbol.iterator]();!(n=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}return r}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=c(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw i}}}}function l(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e,t,r,n,o,i,a){try{var l=e[i](a),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,o)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){u(i,n,o,a,l,"next",e)}function l(e){u(i,n,o,a,l,"throw",e)}a(void 0)}))}}var f;Sentry.init({dsn:"https://d7f3363dd3774a64ad700b4523bcb789@o407795.ingest.sentry.io/5277451"});var y=!1,p="[class*='FlightsTicket_container'] [role='button']",m=0;function v(){for(var e=l(document.querySelectorAll("button")),t=l(document.querySelectorAll('[role="button"]')),r=function(){var e=o[n],r=new Date("".concat(e,"T00:00:00")).toDateString().split(" "),i=r[0]+r[2]+r[1];t.find((function(e){return e.textContent.includes(i)})).click()},n=0,o=[f.fromDate,f.toDate];n<o.length;n++)r();e.find((function(e){return"Continue"===e.textContent})).click(),chrome.runtime.sendMessage({event:"SEND_BEGIN_EVENT",provider:"skyscanner"})}function h(){y=!1,chrome.runtime.sendMessage({event:"FOCUS_WEBPAGE"})}function A(){return g.apply(this,arguments)}function g(){return(g=d((function*(){if(!y){var e=document.querySelector("[class^='FlightsDayView_results__']");if(!e)return k(),void(yield w());if(!y){var t=l(e.querySelectorAll("button")).find((function(e){return"Show more results"===e.textContent}));t&&(t.click(),yield w()),y||window.scroll(0,window.pageYOffset+500)}}}))).apply(this,arguments)}function w(){return new Promise((function(e){setTimeout(e,3e3)}))}function S(){return(S=d((function*(){if(document.querySelector(p)){if(!y){var e,t=0;window.addEventListener("scroll",(function t(){if(y)return window.cancelAnimationFrame(e),void window.removeEventListener("scroll",t);var r=l(document.querySelectorAll(p+':not([data-visited="true"])'));if(r.length>0){m+=r.length;var n=_(r);n.length>0&&chrome.runtime.sendMessage({event:"FLIGHT_RESULTS_RECEIVED",flights:n,provider:"skyscanner"})}if(b()){if(window.cancelAnimationFrame(e),window.removeEventListener("scroll",t),!m&&0===N.length)return void chrome.runtime.sendMessage({event:"NO_FLIGHTS_FOUND",provider:"skyscanner"});if(y)return;N.length>0&&(window.addEventListener("scroll",(function e(){0===window.pageYOffset&&(q(),window.removeEventListener("scroll",e))})),window.scroll(0,0))}})),e=window.requestAnimationFrame(r)}}else v();function r(e){return n.apply(this,arguments)}function n(){return(n=d((function*(n){t&&!(n-t>=350)||(yield A(),t=n),e=window.requestAnimationFrame(r)}))).apply(this,arguments)}}))).apply(this,arguments)}function b(){return window.innerHeight+window.pageYOffset>=document.body.offsetHeight-2}function C(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=l(document.querySelectorAll(p+t)),n=a(r);try{for(n.s();!(e=n.n()).done;){var o=e.value,i=l(o.querySelectorAll("[class^='LegDetails_container']"));j(o,i),o.dataset.visited="true"}}catch(e){n.e(e)}finally{n.f()}r.length}chrome.runtime.onMessage.addListener(function(){var e=d((function*(e){switch(e.event){case"BEGIN_PARSING":if(f=e.formData,document.body.textContent.includes("Page not found"))return void chrome.runtime.sendMessage({event:"NO_FLIGHTS_FOUND",provider:"skyscanner"});new MutationObserver((function(e,t){o=setTimeout((function(){clearTimeout(o),function(){S.apply(this,arguments)}()}),3e3),t.disconnect()})).observe(document.body,{childList:!0,subtree:!0});break;case"HIGHLIGHT_FLIGHT":var t=e.selectedDepartureId,r=e.selectedReturnId;y=!0,k(),function(){var e=document.querySelector("#close");e&&e.click();(e=document.querySelector("[title='Close']"))&&e.click()}(),window.cancelAnimationFrame(0),window.scroll(0,0);var n=10;setTimeout((function(){var e=setInterval(d((function*(){try{k(),C(),function(e,t){var r=document.querySelector("".concat(p,"[data-selected='true']"));r&&(r.dataset.selected="false",r.style.border="");var n=e;t&&(n+="-".concat(t));var o=document.querySelector('[data-id="'.concat(n,'"]'));o.style.border="10px solid #f2554b",o.style.borderRadius="6px",o.style.paddingTop="25px",o.style.paddingBottom="25px",o.dataset.selected="true";var i=window.pageYOffset+o.getBoundingClientRect().top-window.innerHeight/2;window.scroll(0,i)}(t,r),clearInterval(e),function(){if(document.querySelector("#back-to-search"))return;var e=document.createElement("button");e.id="back-to-search",e.textContent="Return to FlightPenguin",e.title="Click to return to FlightPenguin and keep browsing.",e.addEventListener("click",h),document.body.append(e)}()}catch(t){if(n<1)return Sentry.captureException(t,{tags:{component:"highlightSkyscannerItin"},extra:f}),void clearInterval(e);yield A(),n--}})),500)}),500)}var o}));return function(t){return e.apply(this,arguments)}}());var E={fromTime:"[class^='LegInfo_routePartialDepart'] *:first-child",toTime:"[class^='LegInfo_routePartialArrive'] *:first-child",duration:"[class^='LegInfo_stopsContainer'] *:first-child",layovers:"[class^='LegInfo_stopsLabelContainer'] *:first-child",marketingAirline:"[class^='LogoImage_container']",operatingAirline:"[class*='Operators_operator']",from:"[class*='LegInfo_routePartialDepart'] *:nth-child(2)",to:"[class*='LegInfo_routePartialArrive'] *:nth-child(2)"},I={from:"[class*='Routes_routes'] *:first-child",to:"[class*='Routes_routes'] *:nth-child(2)"},L="[class^='TotalPrice_totalPriceContainer']",D="[class^='Price_mainPriceContainer']",F="[class*='CardPrice_totalPrice']";function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.map((function(e){if(e.dataset.visited=!0,e.textContent.includes("Sponsored"))return null;var t;try{t=e.querySelector(D).textContent.trim()}catch(e){return null}var r=/\d stop/.test(e.textContent),n=l(e.querySelectorAll("[class^='LegDetails_container']")),o=j(e,n);if(H[o]&&H[o]===t)return null;if(H[o]=t,r)return N.push(o),null;var a=i(M(n),2),c=a[0],s=a[1];return c?{departureFlight:c,returnFlight:s,fare:t.replace("$",""),currency:"$"}:null}));return t=t.filter((function(e){return e}))}function O(t){var r,o=t.querySelector("[class^='LegSegmentSummary_container']"),c=l(o.querySelectorAll("[class^='AirlineLogoTitle_container']")),s=[],u=a(l(o.querySelectorAll("[class^='LegSegmentDetails_container']")).entries());try{for(u.s();!(r=u.n()).done;){var d=i(r.value,2),f=d[0],y=d[1],p=i(y.querySelector("[class^='Times_segmentTimes']").children,3),m=p[0],v=p[1],h=p[2];m=e(m.textContent),h=e(h.textContent);for(var A={},g=0,w=Object.entries(I);g<w.length;g++){var S=i(w[g],2),b=S[0],C=S[1],E=y.querySelector(C);A[b]=E.textContent.split(/\s/)[0]}var L=c[f].querySelector("[class^='LogoImage_container']"),D=c[f].querySelector("[class*='OperatedBy']");s.push(n({fromTime:m,duration:v.textContent,toTime:h,operatingAirline:D.textContent.toLowerCase().includes("operated")?D.textContent:L.textContent},A))}}catch(e){u.e(e)}finally{u.f()}return s}function k(){var e=document.querySelector("[class*='DetailsPanelHeader_navigationBar'] button[label='back']");e&&e.click()}function q(){return x.apply(this,arguments)}function x(){return(x=d((function*(){if(0===N.length||y)k();else{window.scroll(0,0);var e=N.shift();window.addEventListener("scroll",function(){var t=d((function*(){if(y)window.removeEventListener("scroll",r);else{var t=yield T(e);t?(P(t),window.removeEventListener("scroll",r)):b()&&(q(),window.removeEventListener("scroll",r))}}));function r(){return t.apply(this,arguments)}return r}()),T(e)}}))).apply(this,arguments)}function P(e){e.click();var t=setInterval(d((function*(){var e=document.querySelector("[class*='FlightsBookingPanel_content']");if(e){var r=function(e){var t,r=i(M(l(e.querySelectorAll("[class^='Itinerary_leg']"))),2),n=r[0],o=r[1],a=e.querySelector(L);a||(a=e.querySelector(F));try{t=a.textContent.trim().split("$")[1]}catch(e){return}return{departureFlight:n,returnFlight:o,fare:t,currency:"$"}}(e);r&&(chrome.runtime.sendMessage({event:"FLIGHT_RESULTS_RECEIVED",flights:[r],provider:"skyscanner"}),clearInterval(t),k(),yield w(),C(),q())}})),2e3)}function T(e){return B.apply(this,arguments)}function B(){return(B=d((function*(e){return yield A(),C(':not([data-visited="true"])'),document.querySelector("[data-id='".concat(e,"']"))}))).apply(this,arguments)}function j(r,n){var o,l=[],c=a(n);try{for(c.s();!(o=c.n()).done;){var s=o.value,u=i(s.querySelectorAll("[class*='LegInfo_routePartialTime']"),2),d=u[0],f=u[1],y=s.querySelector(E.marketingAirline),p=s.querySelectorAll("img")[0],m="";m=p?p.alt:y.textContent,m=t.getAirlineName(m),l.push(e(d.textContent),e(f.textContent),m.trim())}}catch(e){c.e(e)}finally{c.f()}var v=l.join("-");return r.dataset.id=v,v}var N=[],H={};function M(e){var t,r=[],n=a(e);try{for(n.s();!(t=n.n()).done;){var o=R(t.value);r.push(o)}}catch(e){n.e(e)}finally{n.f()}return r}function R(t){for(var r={},n=0,o=Object.entries(E);n<o.length;n++){var a=i(o[n],2),l=a[0],c=a[1],s=t.querySelector(c);switch(l){case"operatingAirline":r.operatingAirline=s?s.textContent.replace("Operated by",""):null;break;case"marketingAirline":var u=s.querySelector("img");r.marketingAirline=u?u.alt:s.textContent.trim();break;case"layovers":var d=[];s.textContent.toLowerCase().includes("non")||(s.click(),d=O(t)),r.layovers=d;break;default:["fromTime","toTime"].includes(l)?r[l]=e(s.textContent):r[l]=s.textContent.trim()}}return r}})();