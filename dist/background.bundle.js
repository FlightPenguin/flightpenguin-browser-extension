(()=>{var e={1633:(e,t,r)=>{var n="[object Symbol]",i="\\u0300-\\u036f\\ufe20-\\ufe23",o="[\\ud800-\\udfff]",a="["+i+"\\u20d0-\\u20f0]",u="\\ud83c[\\udffb-\\udfff]",s="[^\\ud800-\\udfff]",c="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",f="(?:"+a+"|"+u+")"+"?",d="[\\ufe0e\\ufe0f]?",p=d+f+("(?:\\u200d(?:"+[s,c,l].join("|")+")"+d+f+")*"),h="(?:"+[s+a+"?",a,c,l,o].join("|")+")",y=RegExp(u+"(?="+u+")|"+h+p,"g"),v=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),m="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,g="object"==typeof self&&self&&self.Object===Object&&self,b=m||g||Function("return this")();function A(e){return v.test(e)}function w(e){return A(e)?function(e){return e.match(y)||[]}(e):function(e){return e.split("")}(e)}var T=Object.prototype.toString,S=b.Symbol,D=S?S.prototype:void 0,P=D?D.toString:void 0;function E(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&T.call(e)==n}(e))return P?P.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function O(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o}(e,t,r)}function C(e){return null==e?"":E(e)}var I,R=(I="toUpperCase",function(e){var t=A(e=C(e))?w(e):void 0,r=t?t[0]:e.charAt(0),n=t?O(t,1).join(""):e.slice(1);return r[I]()+n});e.exports=function(e){return R(C(e).toLowerCase())}}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=["expedia"],t=["expedia"],n=["expedia","kiwi","skyscanner","southwest"],i=function(){},o="https://subscribe.flightpenguin.com";function a(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=function(e,t){for(var r=t.hours;e.hours>r||e.hours===r&&e.minutes>t.minutes;)r+=24;var n=60*r+t.minutes-(60*e.hours+e.minutes),i=Math.floor(n/60),o=n-60*i;return{durationInMinutes:n,duration:i&&!o?"".concat(i,"h"):i?"".concat(i,"h ").concat(o,"m"):"".concat(o,"m")}};function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){var r=e.toLowerCase(),n=c(r.split(":"),2),i=n[0],o=n[1];i=Number(i);var a=Number(o.replace(/(pm)|(am)|(\+\d)/g,"").trim());if(t){var u=e.match(/(\+\d)/);u&&(i+=24*u[0].split("+")[1])}return r.includes("pm")&&i%12!=0?i+=12:r.includes("am")&&i%12==0&&(i-=12),{hours:i,minutes:a}}function d(e){var t,r;if(e.includes("h")){var n=c(e.split("h"),2);t=n[0],r=n[1]}else t=0,r=e;var i=r.trim().split("m")[0]||0;return Number(i)+60*Number(t)}function p(e){var t=f(e,!0),r=t.hours,n=t.minutes,i=e.toLowerCase().match(/(pm)|(am)/)[0],o=e.match(/(\+\d)/);return{hours:r,displayHours:Number(e.split(":")[0]),minutes:n,timeOfDay:i,excessDays:o?o[0]:o}}var h=function(e){return e<=240?15:e<=480?30:60},y=function(e,t,r){return function(e){var t=d(e),r=h(t);return Math.floor(t/r)*r}(e)*function(e){return["econ","prem_econ"].includes(e)?1:"business"===e?2:5}(t)*function(e){return 15*e/60}(r)};function v(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function m(e){v(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):new Date(NaN)}function g(){return function(e){v(1,arguments);var t=m(e);return t.setHours(0,0,0,0),t}(Date.now())}function b(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function A(e,t){v(2,arguments);var r=m(e).getTime(),n=b(t);return new Date(r+n)}var w=36e5;var T=function(e){var t=g();return t=function(e,t){v(2,arguments);var r=b(t);return A(e,6e4*r)}(t=function(e,t){v(2,arguments);var r=b(t);return A(e,r*w)}(t,e.hours),e.minutes)},S=["allegiant","frontier","ryanair","scoot","spirit","sun country"],D=function(e){var t=1;if(function(e){var t=e.operatingAirline.display.toLowerCase();return S.some((function(e){return t.includes(e)}))}(e)&&(t+=2.5),!e.isLayoverStop)return t;t+=1,function(e){return e.from!==e.to}(e)&&(t+=4);var r,n,i=p(e.fromTime),o=T(i),a=p(e.toTime),u=T(a),s=(r=i,n=a,Math.floor(r.hours/24)!==Math.floor(n.hours/24)||r.hours%24<2&&n.hours%24<=9);return s&&(t+=.15),function(e,t,r){var n=r?360:60;return Math.abs(t.valueOf()-e.valueOf())/6e4<n}(o,u,s)&&(t+=1),function(e,t,r){var n=r?600:180;return Math.abs(t.valueOf()-e.valueOf())/6e4>n}(o,u,s)&&(t+=2),t},P=function(e,t){var r=0;e.forEach((function(e){r+=function(e,t){return y(e.duration,t,D(e))}(e,t)}));var n=e.filter((function(e){return e.isLayoverStop})),i=Number("1.0".concat(n.length));return Math.pow(r,i)},E=function(e,t,r){var n=P(r,t);return Math.pow(e,1.05)+n},O=r(1633),C=r.n(O);function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){R=function(e,t){return new o(e,void 0,t)};var r=k(RegExp),n=RegExp.prototype,i=new WeakMap;function o(e,t,n){var o=r.call(this,e,t);return i.set(o,n||i.get(e)),o}function a(e,t){var r=i.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return F(o,r),o.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=a(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=i.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var o=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==I(e[e.length-1])&&e.push(a(e,o)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},R.apply(this,arguments)}function F(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}function k(e){var t="function"==typeof Map?new Map:void 0;return(k=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return L(e,arguments,x(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),N(n,e)})(e)}function L(e,t,r){return(L=j()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&N(i,r.prototype),i}).apply(null,arguments)}function j(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(e){var t=R(/^([\t-\r 0-9A-Z_a-z\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+as[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+(alaska)([a-z]{1,20})$/i,{airline:1,dbaPart1:2,dbaPart2:3}),r=e;if(t.test(r)){var n=r.match(t);r="".concat(n.groups.airline," as ").concat(n.groups.dbaPart1," ").concat(C()(n.groups.dbaPart2))}return r};const _={airlineDetailsMap:{"American Airlines":{display:"American",color:"#C5423E",code:"AA"},American:{display:"American",color:"#C5423E",code:"AA"},Delta:{display:"Delta",color:"#EE722E",code:"DL"},"Delta Air Lines":{display:"Delta",color:"#EE722E",code:"DL"},WN:{display:"Southwest",color:"#F6C04D",code:"WN"},"Southwest Airlines":{display:"Southwest",color:"#F6C04D",code:"WN"},Southwest:{display:"Southwest",color:"#F6C04D",code:"WN"},United:{display:"United",color:"#235EA6",code:"UA"},"United Airlines":{display:"United",color:"#235EA6",code:"UA"},"Air Canada":{display:"Air Canada",color:"#E53222",code:"AC"},Alaska:{display:"Alaska",color:"#51172C",code:"AS"},"Alaska Airlines":{display:"Alaska",color:"#51172C",code:"AS"},jetBlue:{display:"jetBlue",color:"#5F90C8",code:"B6"},"JetBlue Airways":{display:"jetBlue",color:"#5F90C8",code:"B6"},Spirit:{display:"Spirit",color:"#BBB140",code:"NK"},"Spirit Airlines":{display:"Spirit",color:"#BBB140",code:"NK"},WestJet:{display:"WestJet",color:"#4BA89C",code:"WS"},Aeromexico:{display:"Aeromexico",color:"#000000",code:"AM"},Frontier:{display:"Frontier",color:"#378055",code:"F9"},"Frontier Airlines":{display:"Frontier",color:"#378055",code:"F9"},Interjet:{display:"Interjet",color:"#A8A8A8",code:"4O"},Icelandair:{display:"Icelandair",color:"#043C84",code:"FI"},"Hawaiian Airlines":{display:"Hawaiian",color:"#4D388A",code:"HA"},"Sun Country":{display:"Sun Country",color:"#D79A71",code:"SY"},"Sun Country Airlines":{display:"Sun Country",color:"#D79A71",code:"SY"},"Porter Airlines":{display:"Porter",color:"#0F2B53",code:"PD"},"China Southern Airlines":{display:"China Southern",color:"#93ACCA",code:"CZ"},Lufthansa:{display:"Lufthansa",color:"#0A1D3D",code:"LH"},SWISS:{display:"Swiss",color:"#D42D21",code:"LX"},"Swiss International Air Lines":{display:"Swiss",color:"#D42D21",code:"LX"},"China Eastern Airlines":{display:"China Eastern",color:"#A9545F",code:"MU"},"British Airways":{display:"British",color:"#EA8E8C",code:"BA"},Iberia:{display:"Iberia",color:"#D05653",code:"IB"},"Air China":{display:"Air China",color:"#DF524B",code:"CA"},"Emirates Airlines":{display:"Emirates",color:"#CF534F",code:"EK"},"KLM-Royal Dutch Airlines":{display:"KLM",color:"#44A0DC",code:"KL"},"KLM Royal Dutch Airlines":{display:"KLM",color:"#44A0DC",code:"KL"},"Air France":{display:"Air France",color:"#DB3832",code:"AF"},"Turkish Airlines":{display:"Turkish",color:"#DB3832",code:"TK"},"Cathay Pacific":{display:"Cathay",color:"#2A645A",code:"CX"},"Cathay Dragon":{display:"Cathay",color:"#2A645A",code:"CX"},"EVA Airways":{display:"EVA",color:"#6F9F64",code:"BR"},"China Airlines":{display:"China Airlines",color:"#DAABB1",code:"CI"},"ANA Airlines":{display:"ANA",color:"#254897",code:"NH"},"Japan Airlines":{display:"Japan Airlines",color:"#E56E69",code:"JL"},"Air India":{display:"Air India",color:"#D47346",code:"AI"},"Air India Limited":{display:"Air India",color:"#D47346",code:"AI"},"Qantas Airways":{display:"Qantas",color:"#E34538",code:"QF"},"Singapore Airlines":{display:"Singapore",color:"#EFA952",code:"SQ"},"ANA (All Nippon Airways)":{display:"ANA",color:"#0f4a8d"},"Breeze Airways":{display:"Breeze Airways",color:"#ABC3EB",code:"MX"},"Virgin Atlantic":{display:"Virgin Atlantic",color:"#AA1C2A",code:"VS"},"Virgin Atlantic Airways":{display:"Virgin Atlantic",color:"#AA1C2A",code:"VS"},Finnair:{display:"Finnair",color:"#7F1F89",code:"AY"}},getAirlineName:function(e){if(e&&"string"==typeof e){var t=e.trim().replace(/\s+/g," ");t=M(t);var r=this.airlineDetailsMap[t];return r&&(t=r.display),t}},getAirlineDetails:function(e){var t=e.trim().replace(/\s+/g," ");return t=M(t),this.airlineDetailsMap[t]||{display:t,color:"#DFCCFB"}}};var U=["Aer Lingus Regional","Aeromexico Connect","SkyWest","Alaska Horizon","Horizon Air","Alitalia CityLiner","Air Canada Express","Air New Zealand Link","American Eagle","Delta Connection","Fiji Link","HOP!","Iberia Regional","KLM Cityhopper","Lufthansa Regional","MoÃ§ambique Expresso","Ohana by Hawaiian","PAL Express","QantasLink","South African Express","TAP Express","Tunisair Express","United Express","Virgin Australia Regional Airlines","WestJet Encore","WestJet Link"];const B=function(e){var t=e.toLowerCase(),r=U.find((function(e){return t.includes(e.toLowerCase())}));return Boolean(r)};function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return W(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){z(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y(e,t,r,n,i,o,a,u,s,c,l,f,p,h){this.fromTime=e,this.toTime=i,this.fromTimeDetails=t,this.toTimeDetails=o,this.fromDateTime=r,this.toDateTime=a,this.fromLocalTime=n,this.toLocalTime=u,this.toLocalDateTime=s;var y=c?c.replace("Operated by","").replace("Partially operated by",""):c;y=_.getAirlineName(y);var v=_.getAirlineName(l);if(y){var m=c.includes("Partially operated by");B(y)||m?(this.operatingAirline=v,this.marketingAirlineText=m?c:"Operated by ".concat(y)):(this.operatingAirline=y,this.marketingAirlineText="Marketed by ".concat(v))}else this.operatingAirline=v;this.operatingAirline=K(this.operatingAirline),this.id="".concat(this.fromLocalTime,"-").concat(this.toLocalTime,"-").concat(v),this.duration=f,this.durationMinutes=d(f),this.layovers=p||[],this.itinIds=[],this.timezoneOffset=h,this.updateLayovers()}function K(e){var t=[e];e.includes("Partially operated by")?t=e.split("Partially operated by "):e.includes("Operated by")&&(t=e.split("Operated by"));var r,n=t[t.length-1].trim().split(" + ");return r=1===n.length?n[0]:n.map((function(e){return _.getAirlineName(e.replace("  "," "))})).join(", "),_.getAirlineDetails(r.replace("  "," "))}function J(e,t,r){for(var n=0,i=Object.entries(e);n<i.length;n++){var o=H(i[n],2),a=(o[0],o[1]),u=t[a.itinIds.sort((function(e,r){return t[e].fareNumber-t[r].fareNumber}))[0]].fareNumber;a.pain=E(u,r,a.layovers)}return Object.values(e).sort((function(e,t){return e.pain-t.pain}))}function X(e,t,r,n,i,o,a,u){this.depFlight=u?e:new Y(e.fromTime,e.fromTimeDetails,e.fromDateTime,e.fromLocalTime,e.toTime,e.toTimeDetails,e.toDateTime,e.toLocalTime,e.toLocalDateTime,e.operatingAirline,e.marketingAirline,e.duration,e.layovers,e.timezoneOffset),t?(this.retFlight=new Y(t.fromTime,t.fromTimeDetails,t.fromDateTime,t.fromLocalTime,t.toTime,t.toTimeDetails,t.toDateTime,t.toLocalTime,e.toLocalDateTime,t.operatingAirline,t.marketingAirline,t.duration,t.layovers,t.timezoneOffset),this.id="".concat(this.depFlight.id,"-").concat(this.retFlight.id)):this.id=this.depFlight.id,this.provider=i,this.windowId=o,this.tabId=a,this.fareNumber=Number("".concat(r).match(/\d+/g).join("")),this.currency=n}function $(e,t,r,n,i,o){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u={};return e.forEach((function(e){var s=new X(e.departureFlight,e.returnFlight,e.fare,e.currency,n,i,o,a);t[s.depFlight.id]?s.depFlight=t[s.depFlight.id]:t[s.depFlight.id]=s.depFlight,s.retFlight&&(u[s.retFlight.id]?s.retFlight=u[s.retFlight.id]:u[s.retFlight.id]=s.retFlight,s.retFlight.itinIds.push(s.id)),s.depFlight.itinIds.push(s.id),r[s.id]=s})),{itins:r,departures:t,returns:u}}function q(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Q(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Y.prototype.updateLayovers=function(){var e=this;if(this.layovers.length){for(var t=this.layovers.map((function(t,r){var n=t.fromTime,i=t.toTime,o=t.duration,a=t.operatingAirline,u=t.timezoneOffset;return V(V({},e.layovers[r]),{},{fromTimeDetails:p(n),toTimeDetails:p(i),duration:o,operatingAirline:K(a),timezoneOffset:u,isLayoverStop:!1})})),r=[],n=0;n<t.length-1;n++){var i=t[n],o=t[n+1],a=i.toTime,u=i.to,c=i.toLocalTime,l=i.toTimeDetails,f=o.fromTime,d=o.from,h=o.fromLocalTime,y=o.fromTimeDetails,v=s(l,y),m=v.durationInMinutes,g=v.duration;r.push(i),r.push({fromTime:a,fromTimeDetails:l,fromLocalTime:c,toTime:f,toTimeDetails:y,toLocalTime:h,duration:g,durationInMinutes:m,from:u,to:d,timezoneOffset:0,isLayoverStop:!0,operatingAirline:{display:"Layover at ".concat(u,"."),color:"transparent"}})}r.push(t[t.length-1]),this.layovers=r}};var Z=function(t){return e.some((function(e){return t.includes(e)}))},ee=function(e,t,r,n){var i,o=q(r);try{var a=function(){var o=i.value,a=t.getTabId(o);if(null!=a){var u=function(){chrome.tabs.sendMessage(a,{event:"GET_RETURN_FLIGHTS",departure:e,itin:n[r.indexOf(o)]}),t.setTimer(o,1e4,(function(){Sentry.captureException(new Error("Scraper failed for ".concat(o," return flights")),{extra:t.getFormData()})}))};t.getReady(o)?u():t.setOnReady(o,u)}};for(o.s();!(i=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}},te=function(e,t){var r,n=t.getItineraries().itineraries,i=J((r=n,e.itinIds.map((function(e){return r[e].retFlight}))),n,t.getFormCabinValue());t.addReturns(i);var o={event:"RETURN_FLIGHTS_FOR_CLIENT",flights:{departureList:J(t.getDepartures(),n,t.getFormCabinValue()),returnList:t.getReturns(),itins:n,updatedAt:new Date},formData:t.getFormData()};t.sendMessageToIndexPage(o),t.sendMessageToIndexPage({event:"SCRAPING_COMPLETED",searchType:"RETURN"},3e3)};function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){ie(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ie(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var oe=function e(t,r,n){if(0!==r.length){var i=t.getWindowId(n),o=t.getTabId(n);if(null!=i&&null!=o){var a=t.getItineraries(),u=a.itineraries,s=a.version,c=$(r,t.getDepartures(),u,n,i,o),l=c.departures,f=c.itins;if(!t.setItineraries(ne({},f),s))return e(t,r,n);t.setPartialReturn(n,"DEPARTURE"),t.setDepartures(ne({},l));var d=t.getDepartures(),p=t.getItineraries().itineraries,h={event:"FLIGHT_RESULTS_FOR_CLIENT",flights:{departureList:J(d,p,t.getFormCabinValue()),itins:p,returnList:J(t.getReturns(),p,t.getFormCabinValue()),updatedAt:new Date},formData:t.getFormData()};t.sendMessageToIndexPage(h)}}};function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){se(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function se(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ce=function e(t,r,n){if(0!==r.length){var i=t.getWindowId(n),o=t.getTabId(n);if(null!=i&&null!=o){var a=t.getItineraries(),u=a.itineraries,s=a.version,c=$(r,t.getDepartures(),u,n,i,o,!0),l=c.returns,f=c.itins,d=ue(ue({},u),f);if(!t.setItineraries(d,s))return e(t,r,n);t.setPartialReturn(n,"RETURN");var p=J(Object.values(l),d,t.getFormCabinValue());t.addReturns(p);var h={event:"RETURN_FLIGHTS_FOR_CLIENT",flights:{departureList:J(t.getDepartures(),d,t.getFormCabinValue()),returnList:t.getReturns(),itins:f,updatedAt:new Date},formData:t.getFormData()};t.sendMessageToIndexPage(h)}}},le=function(e,t,r){var n=t;r&&(n+="-".concat(r));var i=e.getItineraries();!function(e,t){var r;if(null!==(r=e.getFormData())&&void 0!==r&&r.searchByPoints)return void chrome.tabs.create({url:"https://flightpenguin.com/flight-penguin-points"});var n=e.getWindowId(t.provider);null!=n&&null!==t.tabId&&void 0!==t.tabId&&chrome.windows.update(n,{focused:!0},(function(e){chrome.tabs.sendMessage(t.tabId,{event:"HIGHLIGHT_FLIGHT",selectedDepartureId:t.depFlight.id,selectedReturnId:t.retFlight?t.retFlight.id:"",provider:t.provider}),chrome.tabs.update(t.tabId,{selected:!0})}))}(e,i.itineraries[n])};function fe(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}var de=function(){var e,t=(e=function*(){return yield pe()},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){fe(o,n,i,a,u,"next",e)}function u(e){fe(o,n,i,a,u,"throw",e)}a(void 0)}))});return function(){return t.apply(this,arguments)}}(),pe=function(){return new Promise((function(e){chrome.identity.getAuthToken({interactive:!0},(function(t){e(t)}))}))};function he(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}var ye=function(){var e,t=(e=function*(e){var t=e.position,r=e.page,n=yield de(),i=yield fetch("".concat(o,"/api/airport/location?latitude=").concat(t.coords.latitude,"&longitude=").concat(t.coords.longitude,"&page=").concat(r),{method:"GET",credentials:"include",mode:"cors",headers:new Headers({"Content-Type":"application/json",Authorization:"Bearer ".concat(n)})});if(200===i.status)return{options:(yield i.json()).map((function(e){return{key:e.iataCode,label:e.iataCode,name:e.displayName,location:e.displayLocation,value:e.iataCode}}))};throw new Error("".concat(i.status,": ").concat(i.json()))},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){he(o,n,i,a,u,"next",e)}function u(e){he(o,n,i,a,u,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}();function ve(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}function me(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){ve(o,n,i,a,u,"next",e)}function u(e){ve(o,n,i,a,u,"throw",e)}a(void 0)}))}}var ge=function(){var e=me((function*(e){var t=yield ye({position:e,page:0});t.options.length&&localStorage.setItem("nearby-airports",JSON.stringify(t))}));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=me((function*(){return new Promise((function(e,t){return navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!1,timeout:1e3,maximumAge:72e5})}))}));return function(){return e.apply(this,arguments)}}(),Ae=function(){var e=me((function*(){var e=yield be();yield ge(e)}));return function(){return e.apply(this,arguments)}}(),we=function(e){var t=e.extensionOpenCallback,r=e.extensionClosedCallback,n=Te();chrome.tabs.query({},(function(e){var i=e.find((function(e){return e.url===n}));i?t(i):r()}))},Te=function(){var e=chrome.runtime.id;return"chrome-extension://".concat(e,"/index.html")};function Se(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}var De=function(){var e,t=(e=function*(){try{Pe();var e=yield de();(yield(t=e,fetch("".concat(o,"/api/subscription/status"),{method:"GET",credentials:"include",mode:"cors",headers:new Headers({"Content-Type":"application/json",Authorization:"Bearer ".concat(t)})}).then((function(e){if(200===e.status)return e.json();throw new Error(e.status)})))).status?(yield Ae(),we({extensionOpenCallback:Oe,extensionClosedCallback:Ce})):chrome.tabs.create({url:o})}catch(e){chrome.tabs.create({url:o})}finally{Ee(),Ie()}var t},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Se(o,n,i,a,u,"next",e)}function u(e){Se(o,n,i,a,u,"throw",e)}a(void 0)}))});return function(){return t.apply(this,arguments)}}(),Pe=function(){chrome.browserAction.disable()},Ee=function(){chrome.browserAction.enable()},Oe=function(e){chrome.windows.update(e.windowId,{focused:!0},(function(){null!=e.id&&chrome.tabs.update(e.id,{active:!0})}))},Ce=function(){chrome.tabs.create({url:chrome.extension.getURL("./index.html")},(function(e){window.setTimeout((function(){null!=e.id&&chrome.tabs.sendMessage(e.id,{})}),1e3)}))},Ie=function(){chrome.runtime.requestUpdateCheck((function(e){"update_available"===e&&chrome.runtime.reload()}))};function Re(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}chrome.runtime.MessageSender;var Fe=function(){var e,t=(e=function*(e){yield De();var t=e.tab;t&&t.id&&chrome.tabs.remove(t.id)},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Re(o,n,i,a,u,"next",e)}function u(e){Re(o,n,i,a,u,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}(),ke={econ:"economy",prem_econ:"premium_economy",business:"business",first:"first"};function Le(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return je(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return je(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ne=function(e){var t=Le(e.split("-"),3),r=t[0];return[t[1],t[2],r].join("/")},xe={econ:"ECONOMY",prem_econ:"PREMIUM_ECONOMY",business:"BUSINESS",first:"FIRST_CLASS"};function Me(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}var _e={econ:"economy",prem_econ:"premiumeconomy",business:"business",first:"first"};function Ue(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}function Be(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}function He(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var We=["FAILED","SUCCESS"],Ge=["SUCCESS"],Ve={southwest:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=e.roundtrip,u=t.toUpperCase(),s=r.toUpperCase(),c="https://www.southwest.com/air/booking/select.html?adultPassengersCount=".concat(o,"&departureDate=").concat(n,"&departureTimeOfDay=ALL_DAY&destinationAirportCode=").concat(s,"&fareType=USD&int=HOMEQBOMAIR&originationAirportCode=").concat(u,"&passengerType=ADULT&reset=true&seniorPassengersCount=0");return c+=a?"&returnDate=".concat(i,"&returnTimeOfDay=ALL_DAY&tripType=roundtrip"):"&returnDate=&returnTimeOfDay=ALL_DAY&tripType=oneway"},skyscanner:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=e.cabin,u=e.roundtrip,s=n.replace(/-/g,"").slice(2),c="https://www.skyscanner.com/transport/flights/".concat(t,"/").concat(r,"/").concat(s,"/");if(u){var l=i.replace(/-/g,"").slice(2);c+="".concat(l,"/")}return"".concat(c,"?adults=").concat(o,"&children=0&adultsv2=").concat(o,"&childrenv2=&infants=0&cabinclass=").concat(_e[a||"econ"])},expedia:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=e.cabin,u=e.roundtrip,s=Ne(n),c="https://www.expedia.com/Flights-Search?mode=search&trip=".concat(u?"roundtrip":"oneway","&leg1=from:").concat(t,",to:").concat(r,",departure:").concat(s,"TANYT&leg2=from:").concat(r,",to:").concat(t,",");if(u){var l=Ne(i);c+="departure:".concat(l,"TANYT")}else c+="departure:".concat(s,"TANYT");return c+="&passengers=adults:".concat(o,",children:0,seniors:0,infantinlap:N&options=carrier:*,"),c+="cabinclass:".concat(ke[a||"econ"],","),c+="maxhops:1,nopenalty:N&pageId=0"},kiwi:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=(e.cabin,e.roundtrip?i:"no-return"),u=xe[e.cabin||"econ"];return"https://www.kiwi.com/us/search/results/".concat(t,"/").concat(r,"/").concat(n,"/").concat(a,"?adults=").concat(o,"&cabinClass=").concat(u,"-false&returnFromDifferentAirport=false&returnToDifferentAirport=false")}},ze=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.knownProviders=[],this.state={},this.itineraries={},this.itinerariesVersion=0,this.departures={},this.returns=[],this.selectedProviders=[],this.formData=null,this.primaryTab=null,this.setPrimaryTab(),this.setupClosePrimaryTabListener()}var r,o,a;return r=e,(o=[{key:"setupClosePrimaryTabListener",value:function(){var e=this;chrome.tabs.onRemoved.addListener((function(t){t===e.getPrimaryTabId()&&e.closeWindows()}))}},{key:"getPrimaryTabId",value:function(){var e;return null===(e=this.primaryTab)||void 0===e?void 0:e.id}},{key:"setFormData",value:function(e){this.formData=e,this.knownProviders=this.formData.searchByPoints?t:n,this.setDefault()}},{key:"getFormData",value:function(){return this.formData}},{key:"getFormCabinValue",value:function(){var e;return(null===(e=this.formData)||void 0===e?void 0:e.cabin)||"econ"}},{key:"setSelectedProviders",value:function(e){this.selectedProviders=e}},{key:"setStatus",value:function(e,t,r){"DEPARTURE"===r?this.state[e].departureStatus=t:("RETURN"===r||(this.state[e].departureStatus=t),this.state[e].returnStatus=t)}},{key:"setPending",value:function(e,t){this.setStatus(e,"PENDING",t)}},{key:"setParsing",value:function(e,t){this.setStatus(e,"PARSING",t),this.incrementParsingAttempts(e)}},{key:"setFailed",value:function(e,t){this.setStatus(e,"FAILED",t)}},{key:"setSuccessful",value:function(e,t){this.setStatus(e,"SUCCESS",t)}},{key:"setPartialReturn",value:function(e,t){var r;(r="BOTH"===t?this.getStatus(e,"DEPARTURE")&&this.getStatus(e,"RETURN"):this.getStatus(e,t))&&We.includes(r)||this.setStatus(e,"PARTIAL_RETURN_CONTINUING",t)}},{key:"getStatus",value:function(e,t){return"DEPARTURE"===t?this.getDepartureStatus(e):this.getReturnStatus(e)}},{key:"getDepartureStatus",value:function(e){return this.state[e].departureStatus}},{key:"getReturnStatus",value:function(e){return this.state[e].returnStatus}},{key:"isProviderDepartureComplete",value:function(e){var t=this.getDepartureStatus(e);return!!t&&We.includes(t)}},{key:"isProviderReturnComplete",value:function(e){var t=this.getReturnStatus(e);return!!t&&We.includes(t)}},{key:"isDepartureComplete",value:function(){var e=this;return this.knownProviders.every((function(t){return e.isProviderDepartureComplete(t)}))}},{key:"isReturnComplete",value:function(){var e=this;return(this.selectedProviders.length?this.selectedProviders:this.knownProviders).every((function(t){return e.isProviderReturnComplete(t)}))}},{key:"isComplete",value:function(e){return"BOTH"===e?this.isDepartureComplete()&&this.isReturnComplete():"DEPARTURE"===e?this.isDepartureComplete():this.isReturnComplete()}},{key:"isProviderDepartureSuccessful",value:function(e){var t=this.getDepartureStatus(e);return!!t&&Ge.includes(t)}},{key:"isProviderReturnSuccessful",value:function(e){var t=this.getReturnStatus(e);return!!t&&Ge.includes(t)}},{key:"isDepartureSuccessful",value:function(){var e=this;return this.knownProviders.every((function(t){e.isProviderDepartureSuccessful(t)}))}},{key:"isReturnSuccessful",value:function(){var e=this;return this.knownProviders.every((function(t){e.isProviderReturnSuccessful(t)}))}},{key:"getItineraries",value:function(){return{itineraries:this.itineraries,version:this.itinerariesVersion}}},{key:"setItineraries",value:function(e,t){return t===this.itinerariesVersion&&(this.itineraries=e,this.itinerariesVersion+=1,!0)}},{key:"getDepartures",value:function(){return this.departures}},{key:"getDeparture",value:function(e){return this.departures[e]}},{key:"setDepartures",value:function(e){this.departures=e}},{key:"getReturns",value:function(){return this.returns}},{key:"addReturns",value:function(e){this.returns=this.returns.concat(e).sort((function(e,t){return e.pain-t.pain}))}},{key:"setReturns",value:function(e){this.returns=e}},{key:"setReady",value:function(e,t){this.state[e].ready=t}},{key:"getReady",value:function(e){return this.state[e].ready}},{key:"setOnReady",value:function(e,t){this.state[e].onReady=t}},{key:"getOnReady",value:function(e){return this.state[e].onReady}},{key:"setDefault",value:function(){var e=this;this.knownProviders.forEach((function(t){e.state[t]={departureStatus:"PENDING",returnStatus:"PENDING",ready:!0,onReady:i,timer:null,attempts:0}})),this.itineraries={},this.itinerariesVersion=0,this.departures={},this.returns=[]}},{key:"setTimer",value:function(e,t,r){this.state[e].timer=setTimeout(r,t)}},{key:"getTimer",value:function(e){return this.state[e].timer}},{key:"clearTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=this.state[e].timer;t&&(clearTimeout(t),this.state[e].timer=null)}))},{key:"setTab",value:function(e,t){this.state[e].tab=t}},{key:"setWindow",value:function(e,t){this.state[e].window=t}},{key:"getTabId",value:function(e){var t;return null===(t=this.state[e].tab)||void 0===t?void 0:t.id}},{key:"getTabIndex",value:function(e){var t;return null===(t=this.state[e].tab)||void 0===t?void 0:t.index}},{key:"getWindowId",value:function(e){var t;return null===(t=this.state[e].window)||void 0===t?void 0:t.id}},{key:"setPrimaryTab",value:function(){var e=this;we({extensionOpenCallback:function(t){e.primaryTab=t},extensionClosedCallback:function(){(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=0;return t&&r&&(n+=Me(t,r)),new Promise((function(t){setTimeout(t,e+n)}))})(500).then((function(){e.setPrimaryTab()}))}})}},{key:"createWindow",value:function(e,t,r,n){var i=this;this.setParsing(t,"BOTH");var o=r.height,a=r.width,u=r.left,s=r.top,c=this;return new Promise((function(r){chrome.windows.create({url:e,focused:!1,height:o,width:a,left:u,top:s},function(){var e,o=(e=function*(e){if(i.setPrimaryTabAsFocus(),!e||!e.tabs)throw new Error("Unable to create window - no window!");c.setTab(t,e.tabs[0]),c.setWindow(t,e),chrome.tabs.onUpdated.addListener((function e(i,o){"complete"===o.status&&i===c.getTabId(t)&&(chrome.tabs.onUpdated.removeListener(e),chrome.tabs.sendMessage(i,n),r())}))},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Be(o,n,i,a,u,"next",e)}function u(e){Be(o,n,i,a,u,"throw",e)}a(void 0)}))});return function(e){return o.apply(this,arguments)}}())}))}},{key:"closeWindow",value:function(e){var t=this.getWindowId(e);null!=t&&chrome.windows.remove(t)}},{key:"closeWindows",value:function(){var e=this;this.knownProviders.forEach((function(t){e.closeWindow(t)}))}},{key:"searchForResults",value:function(e,t){var r=this;this.setFormData(e);var n={event:"BEGIN_PARSING",formData:e},i=this.knownProviders.map((function(i){var o=Ve[i](e);return r.createWindow(o,i,t,n)}));Promise.all(i).then((function(){r.setPrimaryTabAsFocus()}))}},{key:"sendMessageToIndexPage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r="chrome-extension://".concat(chrome.runtime.id,"/index.html");chrome.tabs.query({url:r},(function(r){if(r&&r.length){var n,i=null===(n=r[0])||void 0===n?void 0:n.id;i&&setTimeout((function(){chrome.tabs.sendMessage(i,e)}),t)}}))}},{key:"incrementParsingAttempts",value:function(e){this.state[e].attempts+=1}},{key:"retry",value:function(e,t){var r=this;if(this.closeWindow(e),this.state[e].attempts<2&&this.formData){var n=Ve[e](this.formData),i={event:"BEGIN_PARSING",message:this.formData};return this.createWindow(n,e,t,i).then((function(){r.setPrimaryTabAsFocus()})),!0}return!1}},{key:"setPrimaryTabAsFocus",value:function(){var e="chrome-extension://".concat(chrome.runtime.id,"/index.html");chrome.tabs.query({url:e},(function(e){if(e&&e.length){var t=e[0];t.id&&chrome.tabs.update(t.id,{active:!0},(function(e){null!=e&&e.windowId&&chrome.windows.update(e.windowId,{focused:!0})}))}}))}}])&&He(r.prototype,o),a&&He(r,a),e}();function Ye(e,t,r,n,i,o,a){try{var u=e[o](a),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,i)}Sentry.init({dsn:"https://d7f3363dd3774a64ad700b4523bcb789@o407795.ingest.sentry.io/5277451"}),chrome.runtime.setUninstallURL("https://forms.gle/s1BfyyBQb5qtXr7H6",(function(){})),chrome.runtime.onInstalled.addListener(function(){var e,t=(e=function*(e){yield De()},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){Ue(o,n,i,a,u,"next",e)}function u(e){Ue(o,n,i,a,u,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}()),chrome.browserAction.onClicked.addListener((function(){De()}));var Ke=new ze;!function(e){chrome.runtime.onUpdateAvailable.addListener((function(t){var r=chrome.runtime.getManifest();e.sendMessageToIndexPage({event:"UPDATE_AVAILABLE",newVersion:t.version,currentVersion:r.version})}))}(Ke),chrome.runtime.onMessage.addListener(function(){var t,r=(t=function*(t,r,n){switch(t.event){case"FORM_DATA_RECEIVED":!function(e,t,r){e.closeWindows(),e.searchForResults(t,r)}(Ke,t.formData,t.windowConfig);break;case"NO_FLIGHTS_FOUND":!function(e,t,r){if(e.setSuccessful(t,r),e.sendMessageToIndexPage({event:"SCRAPER_COMPLETE",providerName:t,status:"SUCCESS"}),e.closeWindow(t),e.isComplete(r)){var n="BOTH"===r?"DEPARTURE":r;e.sendMessageToIndexPage({event:"SCRAPING_COMPLETED",searchType:n},3e3),e.closeWindows()}}(Ke,t.provider,t.searchType);break;case"SUCCESSFUL_SCRAPER":!function(e,t,r){if(e.setSuccessful(t,r),e.sendMessageToIndexPage({event:"SCRAPER_COMPLETE",providerName:t,status:"SUCCESS"}),e.isComplete(r)){var n="BOTH"===r?"DEPARTURE":r;e.sendMessageToIndexPage({event:"SCRAPING_COMPLETED",searchType:n},3e3)}}(Ke,t.providerName,t.searchType);break;case"FAILED_SCRAPER":!function(e,t,r,n,i){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(e.setFailed(t,n),!e.retry(t,i)){if(e.sendMessageToIndexPage({event:"SCRAPER_COMPLETE",providerName:t,status:"FAILED"}),o&&e.closeWindow(t),e.isComplete(n)){var a="BOTH"===n?"DEPARTURE":n;e.sendMessageToIndexPage({event:"SCRAPING_COMPLETED",searchType:a},3e3)}window.Sentry.captureException(new Error("Scraper (".concat(n,") failed for ").concat(t)),{extra:e.getFormData(),details:r})}}(Ke,t.providerName,t.description,t.searchType,t.windowConfig);break;case"FLIGHT_RESULTS_RECEIVED":oe(Ke,t.flights,t.provider);break;case"RETURN_FLIGHTS_RECEIVED":ce(Ke,t.flights,t.provider);break;case"DEPARTURE_SELECTED":!function(e,t){var r;if(null!==(r=e.getFormData())&&void 0!==r&&r.roundtrip){var n=e.getDeparture(t),i=e.getItineraries().itineraries,o=n.itinIds.flatMap((function(e){return i[e]})),a=o.map((function(e){return e.provider}));e.setSelectedProviders(a),Z(a)?ee(n,e,a,o):te(n,e)}}(Ke,t.departureId);break;case"HIGHLIGHT_TAB":le(Ke,t.selectedDepartureId,t.selectedReturnId);break;case"PROVIDER_READY":!function(e,t){e.setReady(t,!0),e.getOnReady(t)(),e.setOnReady(t,i)}(Ke,t.provider);break;case"FOCUS_WEBPAGE":!function(e){e.setPrimaryTabAsFocus()}(Ke);break;case"CLEAR_SELECTIONS":!function(t){t.setReturns([]);var r,n=a(e);try{for(n.s();!(r=n.n()).done;){var o=r.value;t.setReady(o,!1),t.setOnReady(o,i);var u=t.getTabId(o);null!=u&&chrome.tabs.sendMessage(u,{event:"CLEAR_SELECTION"})}}catch(e){n.e(e)}finally{n.f()}}(Ke);break;case"INDEX_UNLOAD":!function(e){e.getFormData()&&e.closeWindows()}(Ke);break;case"UPDATE_NOW":chrome.runtime.reload();break;case"OPEN_EXTENSION":yield Fe(r);break;default:window.Sentry.captureException(new Error(t))}},function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(e){Ye(o,n,i,a,u,"next",e)}function u(e){Ye(o,n,i,a,u,"throw",e)}a(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}())})()})();