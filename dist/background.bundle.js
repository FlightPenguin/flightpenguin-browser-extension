(()=>{var e={1633:(e,t,r)=>{var n="[object Symbol]",i="\\u0300-\\u036f\\ufe20-\\ufe23",o="[\\ud800-\\udfff]",a="["+i+"\\u20d0-\\u20f0]",s="\\ud83c[\\udffb-\\udfff]",u="[^\\ud800-\\udfff]",c="(?:\\ud83c[\\udde6-\\uddff]){2}",l="[\\ud800-\\udbff][\\udc00-\\udfff]",d="(?:"+a+"|"+s+")"+"?",f="[\\ufe0e\\ufe0f]?",p=f+d+("(?:\\u200d(?:"+[u,c,l].join("|")+")"+f+d+")*"),h="(?:"+[u+a+"?",a,c,l,o].join("|")+")",y=RegExp(s+"(?="+s+")|"+h+p,"g"),v=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),m="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,g="object"==typeof self&&self&&self.Object===Object&&self,b=m||g||Function("return this")();function A(e){return v.test(e)}function w(e){return A(e)?function(e){return e.match(y)||[]}(e):function(e){return e.split("")}(e)}var S=Object.prototype.toString,T=b.Symbol,E=T?T.prototype:void 0,D=E?E.toString:void 0;function P(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&S.call(e)==n}(e))return D?D.call(e):"";var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}function O(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:function(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o}(e,t,r)}function I(e){return null==e?"":P(e)}var C,R=(C="toUpperCase",function(e){var t=A(e=I(e))?w(e):void 0,r=t?t[0]:e.charAt(0),n=t?O(t,1).join(""):e.slice(1);return r[C]()+n});e.exports=function(e){return R(I(e).toLowerCase())}}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=["expedia"],t=["expedia"],n=["expedia","skyscanner","southwest"],i=function(){};function o(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var s=r(1633),u=r.n(s);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){l=function(e,t){return new o(e,void 0,t)};var r=f(RegExp),n=RegExp.prototype,i=new WeakMap;function o(e,t,n){var o=r.call(this,e,t);return i.set(o,n||i.get(e)),o}function a(e,t){var r=i.get(t);return Object.keys(r).reduce((function(t,n){return t[n]=e[r[n]],t}),Object.create(null))}return d(o,r),o.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=a(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=i.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+r[t]})))}if("function"==typeof t){var o=this;return n[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==c(e[e.length-1])&&e.push(a(e,o)),t.apply(this,e)}))}return n[Symbol.replace].call(this,e,t)},l.apply(this,arguments)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function f(e){var t="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return p(e,arguments,v(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)})(e)}function p(e,t,r){return(p=h()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&y(i,r.prototype),i}).apply(null,arguments)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){var t=l(/^([\t-\r 0-9A-Z_a-z\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+as[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+(alaska)([a-z]{1,20})$/i,{airline:1,dbaPart1:2,dbaPart2:3}),r=e;if(t.test(r)){var n=r.match(t);r="".concat(n.groups.airline," as ").concat(n.groups.dbaPart1," ").concat(u()(n.groups.dbaPart2))}return r};const g={airlineDetailsMap:{"American Airlines":{display:"American",color:"#C5423E",code:"AA"},American:{display:"American",color:"#C5423E",code:"AA"},Delta:{display:"Delta",color:"#EE722E",code:"DL"},"Delta Air Lines":{display:"Delta",color:"#EE722E",code:"DL"},"Southwest Airlines":{display:"Southwest",color:"#F6C04D",code:"WN"},Southwest:{display:"Southwest",color:"#F6C04D",code:"WN"},United:{display:"United",color:"#235EA6",code:"UA"},"United Airlines":{display:"United",color:"#235EA6",code:"UA"},"Air Canada":{display:"Air Canada",color:"#E53222",code:"AC"},Alaska:{display:"Alaska",color:"#51172C",code:"AS"},"Alaska Airlines":{display:"Alaska",color:"#51172C",code:"AS"},jetBlue:{display:"jetBlue",color:"#5F90C8",code:"B6"},"JetBlue Airways":{display:"jetBlue",color:"#5F90C8",code:"B6"},Spirit:{display:"Spirit",color:"#BBB140",code:"NK"},"Spirit Airlines":{display:"Spirit",color:"#BBB140",code:"NK"},WestJet:{display:"WestJet",color:"#4BA89C",code:"WS"},Aeromexico:{display:"Aeromexico",color:"#000000",code:"AM"},Frontier:{display:"Frontier",color:"#378055",code:"F9"},"Frontier Airlines":{display:"Frontier",color:"#378055",code:"F9"},Interjet:{display:"Interjet",color:"#A8A8A8",code:"4O"},"Hawaiian Airlines":{display:"Hawaiian",color:"#4D388A",code:"HA"},"Sun Country":{display:"Sun Country",color:"#D79A71",code:"SY"},"Sun Country Airlines":{display:"Sun Country",color:"#D79A71",code:"SY"},"Porter Airlines":{display:"Porter",color:"#0F2B53",code:"PD"},"China Southern Airlines":{display:"China Southern",color:"#93ACCA",code:"CZ"},Lufthansa:{display:"Lufthansa",color:"#EFB95D",code:"LH"},SWISS:{display:"Swiss",color:"#D42D21",code:"LX"},"China Eastern Airlines":{display:"China Eastern",color:"#A9545F",code:"MU"},"British Airways":{display:"British",color:"#EA8E8C",code:"BA"},Iberia:{display:"Iberia",color:"#D05653",code:"IB"},"Air China":{display:"Air China",color:"#DF524B",code:"CA"},"Emirates Airlines":{display:"Emirates",color:"#CF534F",code:"EK"},"KLM-Royal Dutch Airlines":{display:"KLM",color:"#44A0DC",code:"KL"},"Air France":{display:"Air France",color:"#DB3832",code:"AF"},"Turkish Airlines":{display:"Turkish",color:"#DB3832",code:"TK"},"Cathay Pacific":{display:"Cathay",color:"#2A645A",code:"CX"},"Cathay Dragon":{display:"Cathay",color:"#2A645A",code:"CX"},"EVA Airways":{display:"EVA",color:"#6F9F64",code:"BR"},"China Airlines":{display:"China Airlines",color:"#DAABB1",code:"CI"},"ANA Airlines":{display:"ANA",color:"#254897",code:"NH"},"Japan Airlines":{display:"Japan Airlines",color:"#E56E69",code:"JL"},"Air India":{display:"Air India",color:"#D47346",code:"AI"},"Air India Limited":{display:"Air India",color:"#D47346",code:"AI"},"Qantas Airways":{display:"Qantas",color:"#E34538",code:"QF"},"Singapore Airlines":{display:"Singapore",color:"#EFA952",code:"SQ"},"ANA (All Nippon Airways)":{display:"ANA",color:"#0f4a8d"}},getAirlineName:function(e){if(e&&"string"==typeof e){var t=e.trim().replace(/\s+/g," ");t=m(t);var r=this.airlineDetailsMap[t];return r&&(t=r.display),t}},getAirlineDetails:function(e){var t=e.trim().replace(/\s+/g," ");return t=m(t),this.airlineDetailsMap[t]||{display:t,color:"#DFCCFB"}}};var b=["Aer Lingus Regional","Aeromexico Connect","SkyWest","Alaska Horizon","Horizon Air","Alitalia CityLiner","Air Canada Express","Air New Zealand Link","American Eagle","Delta Connection","Fiji Link","HOP!","Iberia Regional","KLM Cityhopper","Lufthansa Regional","MoÃ§ambique Expresso","Ohana by Hawaiian","PAL Express","QantasLink","South African Express","TAP Express","Tunisair Express","United Express","Virgin Australia Regional Airlines","WestJet Encore","WestJet Link"];const A=function(e){var t=e.toLowerCase(),r=b.find((function(e){return t.includes(e.toLowerCase())}));return Boolean(r)};function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function T(e,t){var r=e.toLowerCase(),n=w(r.split(":"),2),i=n[0],o=n[1];i=Number(i);var a=Number(o.replace(/(pm)|(am)|(\+\d)/g,"").trim());if(t){var s=e.match(/(\+\d)/);s&&(i+=24*s[0].split("+")[1])}return r.includes("pm")&&i%12!=0?i+=12:r.includes("am")&&i%12==0&&(i-=12),{hours:i,minutes:a}}function E(e){var t,r;if(e.includes("h")){var n=w(e.split("h"),2);t=n[0],r=n[1]}else t=0,r=e;var i=r.trim().split("m")[0]||0;return Number(i)+60*Number(t)}function D(e,t,r){var n=T(e),i=n.hours,o=n.minutes,a=T(t),s=a.hours,u=a.minutes,c=t.match(/(\+\d)/),l=e.match(/(\+\d)/),d=0,f=0;if(l){var p=w(l[0].split("+"),2),h=(p[0],p[1]);f=d+=Number(h)}if(c){var y=w(c[0].split("+"),2),v=(y[0],y[1]);f+=Number(v)}var m=60*(i+24*d)+o,g=60*(s+24*f)+u;return E(r)-(g-m)}function P(e){var t=T(e,!0),r=t.hours,n=t.minutes,i=e.toLowerCase().match(/(pm)|(am)/)[0],o=e.match(/(\+\d)/);return{hours:r,displayHours:Number(e.split(":")[0]),minutes:n,timeOfDay:i,excessDays:o?o[0]:o}}function O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e,t,r,n,i,o){this.fromTime=e,this.toTime=t,this.fromTimeDetails=P(e),this.toTimeDetails=P(t);var a=r?r.replace("Operated by","").replace("Partially operated by",""):r;a=g.getAirlineName(a);var s=g.getAirlineName(n);if(a){var u=r.includes("Partially operated by");A(a)||u?(this.operatingAirline=s,this.marketingAirlineText=u?r:"Operated by ".concat(a)):(this.operatingAirline=a,this.marketingAirlineText="Marketed by ".concat(s))}else this.operatingAirline=s;this.operatingAirline=j(this.operatingAirline),this.id="".concat(this.fromTime,"-").concat(this.toTime,"-").concat(s),this.duration=i,this.durationMinutes=E(i),this.layovers=o||[],this.itinIds=[],this.timezoneOffset=this.calculateTimezoneOffset()}function j(e){var t=[e];e.includes("Partially operated by")?t=e.split("Partially operated by "):e.includes("Operated by")&&(t=e.split("Operated by"));var r,n=t[t.length-1].trim().split(" + ");return r=1===n.length?n[0]:n.map((function(e){return g.getAirlineName(e.replace("  "," "))})).join(", "),g.getAirlineDetails(r.replace("  "," "))}function L(e,t){for(var r=0,n=Object.entries(e);r<n.length;r++){var i=O(n[r],2),o=(i[0],i[1]),a=1;if(o.layovers.length)for(var s=1;s<o.layovers.length;s++)if(o.layovers[s-1].to!==o.layovers[s].from){a=2;break}var u=t[o.itinIds.sort((function(e,r){return t[e].fareNumber-t[r].fareNumber}))[0]].fareNumber;o.pain=(Math.log2(o.durationMinutes)+Math.log2(u)+o.layovers.length)*a}return Object.values(e).sort((function(e,t){return e.pain-t.pain}))}function N(e,t,r,n,i,o,a,s){this.depFlight=s?e:new F(e.fromTime,e.toTime,e.operatingAirline,e.marketingAirline,e.duration,e.layovers),t?(this.retFlight=new F(t.fromTime,t.toTime,t.operatingAirline,t.marketingAirline,t.duration,t.layovers),this.id="".concat(this.depFlight.id,"-").concat(this.retFlight.id)):this.id=this.depFlight.id,this.provider=i,this.windowId=o,this.tabId=a,this.fareNumber=Number("".concat(r).match(/\d+/g).join("")),this.currency=n}function x(e,t,r,n,i,o){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s={};return e.forEach((function(e){var u=new N(e.departureFlight,e.returnFlight,e.fare,e.currency,n,i,o,a);t[u.depFlight.id]?u.depFlight=t[u.depFlight.id]:t[u.depFlight.id]=u.depFlight,u.retFlight&&(s[u.retFlight.id]?u.retFlight=s[u.retFlight.id]:s[u.retFlight.id]=u.retFlight,u.retFlight.itinIds.push(u.id)),u.depFlight.itinIds.push(u.id),r[u.id]=u})),{itins:r,departures:t,returns:s}}function _(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return U(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return U(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}F.prototype.calculateTimezoneOffset=function(){var e=this,t=0;if(this.layovers.length){for(var r=this.layovers.map((function(r,n){var i=r.fromTime,o=r.toTime,a=r.duration,s=r.operatingAirline;return t+=D(i,o,a),R(R({},e.layovers[n]),{},{operatingAirline:j(s),timezoneOffset:t})})),n=[],i=0;i<r.length-1;i++){var o=r[i],a=r[i+1],s=o.toTime,u=o.to,c=a.fromTime,l=a.from;n.push(o),n.push({fromTime:s,toTime:c,from:u,to:l,isLayoverStop:!0,operatingAirline:{display:"Layover at ".concat(u,"."),color:"transparent"}})}n.push(r[r.length-1]),this.layovers=n}else t=D(this.fromTime,this.toTime,this.duration);return t};var M=function(t){return e.some((function(e){return t.includes(e)}))},B=function(e,t,r,n){var i,o=_(r);try{var a=function(){var o=i.value,a=t.getTabId(o);if(null!=a){var s=function(){chrome.tabs.sendMessage(a,{event:"GET_RETURN_FLIGHTS",departure:e,itin:n[r.indexOf(o)]}),t.setTimer(o,1e4,(function(){Sentry.captureException(new Error("Scraper failed for ".concat(o," return flights")),{extra:t.getFormData()})}))};t.getReady(o)?s():t.setOnReady(o,s)}};for(o.s();!(i=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}},H=function(e,t){var r,n=t.getItineraries().itineraries,i=L((r=n,e.itinIds.map((function(e){return r[e].retFlight}))),n);t.addReturns(i);var o={event:"RETURN_FLIGHTS_FOR_CLIENT",flights:{departureList:L(t.getDepartures(),n),returnList:t.getReturns(),itins:n,updatedAt:new Date},formData:t.getFormData()};t.sendMessageToIndexPage(o),t.sendMessageToIndexPage({event:"SCRAPING_COMPLETED",searchType:"RETURN"},3e3)};function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){V(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function V(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Y=function e(t,r,n){if(0!==r.length){var i=t.getWindowId(n),o=t.getTabId(n);if(null!=i&&null!=o){var a=t.getItineraries(),s=a.itineraries,u=a.version,c=x(r,t.getDepartures(),s,n,i,o),l=c.departures,d=c.itins;if(!t.setItineraries(G({},d),u))return e(t,r,n);t.setPartialReturn(n,"DEPARTURE"),t.setDepartures(G({},l));var f=t.getDepartures(),p=t.getItineraries().itineraries,h={event:"FLIGHT_RESULTS_FOR_CLIENT",flights:{departureList:L(f,p),itins:p,returnList:L(t.getReturns(),p),updatedAt:new Date},formData:t.getFormData()};t.sendMessageToIndexPage(h)}}};function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){K(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var $=function e(t,r,n){if(0!==r.length){var i=t.getWindowId(n),o=t.getTabId(n);if(null!=i&&null!=o){var a=t.getItineraries(),s=a.itineraries,u=a.version,c=x(r,t.getDepartures(),s,n,i,o,!0),l=c.returns,d=c.itins,f=J(J({},s),d);if(!t.setItineraries(f,u))return e(t,r,n);t.setPartialReturn(n,"RETURN");var p=L(Object.values(l),f);t.addReturns(p);var h={event:"RETURN_FLIGHTS_FOR_CLIENT",flights:{departureList:L(t.getDepartures(),f),returnList:t.getReturns(),itins:d,updatedAt:new Date},formData:t.getFormData()};t.sendMessageToIndexPage(h)}}},Q=function(e){e.sendMessageToIndexPage({event:"FOCUS_WEBPAGE_CLIENT"});var t=e.getPrimaryWindowId(),r=e.getPrimaryTabId();null!=t&&null!=r&&function(e,t){chrome.windows.update(e,{focused:!0},(function(e){chrome.tabs.update(t,{selected:!0})}))}(t,r)},X=function(e,t,r){var n=t;r&&(n+="-".concat(r));var i=e.getItineraries();!function(e,t){var r;if(null!==(r=e.getFormData())&&void 0!==r&&r.searchByPoints)return void chrome.tabs.create({url:"https://flightpenguin.com/flight-penguin-points"});var n=e.getWindowId(t.provider);null!=n&&null!==t.tabId&&void 0!==t.tabId&&chrome.windows.update(n,{focused:!0},(function(e){chrome.tabs.sendMessage(t.tabId,{event:"HIGHLIGHT_FLIGHT",selectedDepartureId:t.depFlight.id,selectedReturnId:t.retFlight?t.retFlight.id:"",provider:t.provider}),chrome.tabs.update(t.tabId,{selected:!0})}))}(e,i.itineraries[n])};var q={econ:"economy",prem_econ:"premium_economy",business:"business",first:"first"};function Z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ee(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ee(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var te=function(e){var t=Z(e.split("-"),3),r=t[0];return[t[1],t[2],r].join("/")};function re(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}var ne={econ:"economy",prem_econ:"premiumeconomy",business:"business",first:"first"},ie=function(e){var t=e.extensionOpenCallback,r=e.extensionClosedCallback,n=oe();chrome.tabs.query({},(function(e){var i=e.find((function(e){return e.url===n}));i?t(i):r()}))},oe=function(){var e=chrome.runtime.id;return"chrome-extension://".concat(e,"/index.html")};function ae(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function se(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ue=["FAILED","SUCCESS"],ce=["SUCCESS"],le={southwest:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=e.roundtrip,s=t.toUpperCase(),u=r.toUpperCase(),c="https://www.southwest.com/air/booking/select.html?adultPassengersCount=".concat(o,"&departureDate=").concat(n,"&departureTimeOfDay=ALL_DAY&destinationAirportCode=").concat(u,"&fareType=USD&int=HOMEQBOMAIR&originationAirportCode=").concat(s,"&passengerType=ADULT&reset=true&seniorPassengersCount=0");return c+=a?"&returnDate=".concat(i,"&returnTimeOfDay=ALL_DAY&tripType=roundtrip"):"&returnDate=&returnTimeOfDay=ALL_DAY&tripType=oneway"},skyscanner:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=e.cabin,s=e.roundtrip,u=n.replace(/-/g,"").slice(2),c="https://www.skyscanner.com/transport/flights/".concat(t,"/").concat(r,"/").concat(u,"/");if(s){var l=i.replace(/-/g,"").slice(2);c+="".concat(l,"/")}return"".concat(c,"?adults=").concat(o,"&children=0&adultsv2=").concat(o,"&childrenv2=&infants=0&cabinclass=").concat(ne[a||"econ"])},expedia:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=e.cabin,s=e.roundtrip,u=te(n),c="https://www.expedia.com/Flights-Search?mode=search&trip=".concat(s?"roundtrip":"oneway","&leg1=from:").concat(t,",to:").concat(r,",departure:").concat(u,"TANYT&leg2=from:").concat(r,",to:").concat(t,",");if(s){var l=te(i);c+="departure:".concat(l,"TANYT")}else c+="departure:".concat(u,"TANYT");return c+="&passengers=adults:".concat(o,",children:0,seniors:0,infantinlap:N&options=carrier:*,"),c+="cabinclass:".concat(q[a||"econ"],","),c+="maxhops:1,nopenalty:N&pageId=0"},skiplagged:function(e){var t=e.from,r=e.to,n=e.fromDate,i=e.toDate,o=e.numPax,a=e.roundtrip,s="https://skiplagged.com/flights/".concat(t.toUpperCase(),"/").concat(r.toUpperCase(),"/").concat(n);return a&&(s+="/".concat(i)),s+="?adults=".concat(o)}},de=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.knownProviders=[],this.state={},this.itineraries={},this.itinerariesVersion=0,this.departures={},this.returns=[],this.selectedProviders=[],this.formData=null,this.primaryTab=null,this.setPrimaryTab(),this.setupClosePrimaryTabListener()}var r,o,a;return r=e,(o=[{key:"setupClosePrimaryTabListener",value:function(){var e=this;chrome.tabs.onRemoved.addListener((function(t){t===e.getPrimaryTabId()&&e.closeWindows()}))}},{key:"getPrimaryTabId",value:function(){var e;return null===(e=this.primaryTab)||void 0===e?void 0:e.id}},{key:"getPrimaryTabIndex",value:function(){var e;return null===(e=this.primaryTab)||void 0===e?void 0:e.index}},{key:"getPrimaryWindowId",value:function(){var e;return null===(e=this.primaryTab)||void 0===e?void 0:e.windowId}},{key:"setFormData",value:function(e){this.formData=e,this.knownProviders=this.formData.searchByPoints?t:n,this.setDefault()}},{key:"getFormData",value:function(){return this.formData}},{key:"setSelectedProviders",value:function(e){this.selectedProviders=e}},{key:"setStatus",value:function(e,t,r){"DEPARTURE"===r?this.state[e].departureStatus=t:("RETURN"===r||(this.state[e].departureStatus=t),this.state[e].returnStatus=t)}},{key:"setPending",value:function(e,t){this.setStatus(e,"PENDING",t)}},{key:"setFailed",value:function(e,t){this.setStatus(e,"FAILED",t)}},{key:"setSuccessful",value:function(e,t){this.setStatus(e,"SUCCESS",t)}},{key:"setPartialReturn",value:function(e,t){var r;(r="BOTH"===t?this.getStatus(e,"DEPARTURE")&&this.getStatus(e,"RETURN"):this.getStatus(e,t))&&ue.includes(r)||this.setStatus(e,"PARTIAL_RETURN_CONTINUING",t)}},{key:"getStatus",value:function(e,t){return"DEPARTURE"===t?this.getDepartureStatus(e):this.getReturnStatus(e)}},{key:"getDepartureStatus",value:function(e){return this.state[e].departureStatus}},{key:"getReturnStatus",value:function(e){return this.state[e].returnStatus}},{key:"isProviderDepartureComplete",value:function(e){var t=this.getDepartureStatus(e);return!!t&&ue.includes(t)}},{key:"isProviderReturnComplete",value:function(e){var t=this.getReturnStatus(e);return!!t&&ue.includes(t)}},{key:"isDepartureComplete",value:function(){var e=this;return this.knownProviders.every((function(t){return e.isProviderDepartureComplete(t)}))}},{key:"isReturnComplete",value:function(){var e=this;return(this.selectedProviders.length?this.selectedProviders:this.knownProviders).every((function(t){return e.isProviderReturnComplete(t)}))}},{key:"isComplete",value:function(e){return"BOTH"===e?this.isDepartureComplete()&&this.isReturnComplete():"DEPARTURE"===e?this.isDepartureComplete():this.isReturnComplete()}},{key:"isProviderDepartureSuccessful",value:function(e){var t=this.getDepartureStatus(e);return!!t&&ce.includes(t)}},{key:"isProviderReturnSuccessful",value:function(e){var t=this.getReturnStatus(e);return!!t&&ce.includes(t)}},{key:"isDepartureSuccessful",value:function(){var e=this;return this.knownProviders.every((function(t){e.isProviderDepartureSuccessful(t)}))}},{key:"isReturnSuccessful",value:function(){var e=this;return this.knownProviders.every((function(t){e.isProviderReturnSuccessful(t)}))}},{key:"getItineraries",value:function(){return{itineraries:this.itineraries,version:this.itinerariesVersion}}},{key:"setItineraries",value:function(e,t){return t===this.itinerariesVersion&&(this.itineraries=e,this.itinerariesVersion+=1,!0)}},{key:"getDepartures",value:function(){return this.departures}},{key:"getDeparture",value:function(e){return this.departures[e]}},{key:"setDepartures",value:function(e){this.departures=e}},{key:"getReturns",value:function(){return this.returns}},{key:"addReturns",value:function(e){this.returns=this.returns.concat(e).sort((function(e,t){return e.pain-t.pain}))}},{key:"setReturns",value:function(e){this.returns=e}},{key:"setReady",value:function(e,t){this.state[e].ready=t}},{key:"getReady",value:function(e){return this.state[e].ready}},{key:"setOnReady",value:function(e,t){this.state[e].onReady=t}},{key:"getOnReady",value:function(e){return this.state[e].onReady}},{key:"setDefault",value:function(){var e=this;this.knownProviders.forEach((function(t){e.state[t]={departureStatus:"PENDING",returnStatus:"PENDING",ready:!0,onReady:i,timer:null}})),this.itineraries={},this.itinerariesVersion=0,this.departures={},this.returns=[]}},{key:"setTimer",value:function(e,t,r){this.state[e].timer=setTimeout(r,t)}},{key:"getTimer",value:function(e){return this.state[e].timer}},{key:"clearTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=this.state[e].timer;t&&(clearTimeout(t),this.state[e].timer=null)}))},{key:"setTab",value:function(e,t){this.state[e].tab=t}},{key:"setWindow",value:function(e,t){this.state[e].window=t}},{key:"getTabId",value:function(e){var t;return null===(t=this.state[e].tab)||void 0===t?void 0:t.id}},{key:"getTabIndex",value:function(e){var t;return null===(t=this.state[e].tab)||void 0===t?void 0:t.index}},{key:"getWindowId",value:function(e){var t;return null===(t=this.state[e].window)||void 0===t?void 0:t.id}},{key:"setPrimaryTab",value:function(){var e=this;ie({extensionOpenCallback:function(t){e.primaryTab=t},extensionClosedCallback:function(){(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=0;return t&&r&&(n+=re(t,r)),new Promise((function(t){setTimeout(t,e+n)}))})(500).then((function(){e.setPrimaryTab()}))}})}},{key:"createWindow",value:function(e,t,r,n){var i=r.height,o=r.width,a=r.left,s=r.top,u=this;return new Promise((function(r){chrome.windows.create({url:e,focused:!1,height:i,width:o,left:a,top:s},function(){var e,i=(e=function*(e){var i,o;if(!e||!e.tabs||null===(null===(i=u.primaryTab)||void 0===i?void 0:i.windowId)||void 0===(null===(o=u.primaryTab)||void 0===o?void 0:o.windowId))throw new Error("Unable to create window - no window!");chrome.windows.update(u.primaryTab.windowId,{focused:!0}),u.setTab(t,e.tabs[0]),u.setWindow(t,e),chrome.tabs.onUpdated.addListener((function e(i,o){"complete"===o.status&&i===u.getTabId(t)&&(chrome.tabs.onUpdated.removeListener(e),chrome.tabs.sendMessage(i,n),r())}))},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){ae(o,n,i,a,s,"next",e)}function s(e){ae(o,n,i,a,s,"throw",e)}a(void 0)}))});return function(e){return i.apply(this,arguments)}}())}))}},{key:"closeWindow",value:function(e){var t=this.getWindowId(e);null!=t&&chrome.windows.remove(t)}},{key:"closeWindows",value:function(){var e=this;this.knownProviders.forEach((function(t){e.closeWindow(t)}))}},{key:"searchForResults",value:function(e,t){var r,n=this;this.setFormData(e);var i=null==this||null===(r=this.primaryTab)||void 0===r?void 0:r.windowId,o={event:"BEGIN_PARSING",formData:e};if(null!=i){var a=this.knownProviders.map((function(r){var i=le[r](e);return n.createWindow(i,r,t,o)}));Promise.all(a).then((function(){chrome.windows.update(i,{focused:!0})}))}}},{key:"sendMessageToIndexPage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.getPrimaryTabId();null!=r&&setTimeout((function(){chrome.tabs.sendMessage(r,e)}),t)}}])&&se(r.prototype,o),a&&se(r,a),e}();const fe="https://subscribe.flightpenguin.com";function pe(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}var he=function(){chrome.browserAction.disable()},ye=function(){chrome.browserAction.enable()},ve=function(e){chrome.windows.update(e.windowId,{focused:!0},(function(){null!=e.id&&chrome.tabs.update(e.id,{active:!0})}))},me=function(){chrome.tabs.create({url:chrome.extension.getURL("./index.html")},(function(e){window.setTimeout((function(){null!=e.id&&chrome.tabs.sendMessage(e.id,{})}),1e3)}))};Sentry.init({dsn:"https://d7f3363dd3774a64ad700b4523bcb789@o407795.ingest.sentry.io/5277451"}),chrome.runtime.setUninstallURL("https://forms.gle/s1BfyyBQb5qtXr7H6",(function(){})),chrome.runtime.onInstalled.addListener((function(){})),chrome.browserAction.onClicked.addListener((function(){he(),chrome.identity.getAuthToken({interactive:!0},function(){var e,t=(e=function*(e){try{(yield(t=e,fetch("".concat(fe,"/api/subscription/status"),{method:"GET",credentials:"include",mode:"cors",headers:new Headers({"Content-Type":"application/json",Authorization:"Bearer ".concat(t)})}).then((function(e){if(200===e.status)return e.json();throw new Error(e.status)})))).status?ie({extensionOpenCallback:ve,extensionClosedCallback:me}):chrome.tabs.create({url:fe})}catch(e){chrome.tabs.create({url:fe})}finally{ye()}var t},function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){pe(o,n,i,a,s,"next",e)}function s(e){pe(o,n,i,a,s,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}())}));var ge=new de;chrome.runtime.onMessage.addListener((function(t,r,n){switch(t.event){case"FORM_DATA_RECEIVED":!function(e,t,r){e.closeWindows(),e.searchForResults(t,r)}(ge,t.formData,t.windowConfig);break;case"NO_FLIGHTS_FOUND":!function(e,t,r){e.setSuccessful(t,r),e.isComplete(r)&&(e.sendMessageToIndexPage({event:"NO_FLIGHTS_FOUND_CLIENT"}),e.closeWindows())}(ge,t.provider,t.searchType);break;case"SUCCESSFUL_SCRAPER":!function(e,t,r){if(e.setSuccessful(t,r),e.sendMessageToIndexPage({event:"SCRAPER_COMPLETE",providerName:t,status:"SUCCESS"}),e.isComplete(r)){var n="BOTH"===r?"DEPARTURE":r;e.sendMessageToIndexPage({event:"SCRAPING_COMPLETED",searchType:n},3e3)}}(ge,t.providerName,t.searchType);break;case"FAILED_SCRAPER":!function(e,t,r,n){if(e.setFailed(t,n),e.sendMessageToIndexPage({event:"SCRAPER_COMPLETE",providerName:t,status:"FAILED"}),e.closeWindow(t),e.isComplete(n)){var i="BOTH"===n?"DEPARTURE":n;e.sendMessageToIndexPage({event:"SCRAPING_COMPLETED",searchType:i},3e3)}window.Sentry.captureException(new Error("Scraper (".concat(n,") failed for ").concat(t)),{extra:e.getFormData(),details:r})}(ge,t.providerName,t.description,t.searchType);break;case"FLIGHT_RESULTS_RECEIVED":Y(ge,t.flights,t.provider);break;case"RETURN_FLIGHTS_RECEIVED":$(ge,t.flights,t.provider);break;case"DEPARTURE_SELECTED":!function(e,t){var r;if(null!==(r=e.getFormData())&&void 0!==r&&r.roundtrip){var n=e.getDeparture(t),i=e.getItineraries().itineraries,o=n.itinIds.flatMap((function(e){return i[e]})),a=o.map((function(e){return e.provider}));e.setSelectedProviders(a),M(a)?B(n,e,a,o):H(n,e)}}(ge,t.departureId);break;case"HIGHLIGHT_TAB":X(ge,t.selectedDepartureId,t.selectedReturnId);break;case"SEND_BEGIN_EVENT":!function(e,t,r){e.setPending(t,"BOTH");var n=e.getTabId(t);null!=n&&setTimeout((function(){chrome.tabs.sendMessage(n,{event:"BEGIN_PARSING",formData:e.getFormData()})}),r)}(ge,t.provider,2e3);break;case"PROVIDER_READY":!function(e,t){e.setReady(t,!0),e.getOnReady(t)(),e.setOnReady(t,i)}(ge,t.provider);break;case"FOCUS_WEBPAGE":Q(ge);break;case"CLEAR_SELECTIONS":!function(t){t.setReturns([]);var r,n=o(e);try{for(n.s();!(r=n.n()).done;){var a=r.value;t.setReady(a,!1),t.setOnReady(a,i);var s=t.getTabId(a);null!=s&&chrome.tabs.sendMessage(s,{event:"CLEAR_SELECTION"})}}catch(e){n.e(e)}finally{n.f()}}(ge);break;case"INDEX_UNLOAD":!function(e){e.getFormData()&&e.closeWindows()}(ge);break;case"RELOAD_SELECTED_DEPARTURE":!function(e,t,r,n,i){if(!e.getTabId(t))throw new Error("Unable to extract tab for ".concat(t));var o={height:window.outerHeight,width:window.outerWidth,left:window.screenX,top:window.screenY};e.closeWindow(t),e.createWindow(r,t,o,{event:"BEGIN_PARSING_RETURNS",departure:n,departureMap:i})}(ge,t.providerName,t.targetUrl,t.departure,t.departureMap);break;default:window.Sentry.captureException(new Error(t))}}))})()})();